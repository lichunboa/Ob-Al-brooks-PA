# Implementation Log: Task 15

**Summary:** 实现 Analytics 核心：支持 scope 切换（Live/Demo/Backtest/All）、日历热力图（最近 35 天）、轻量 SVG 资金曲线、策略归因 Top 列表（复用 StrategyIndex 以提供策略卡跳转）。

**Timestamp:** 2026-01-02T04:38:51.350Z
**Log ID:** fc3e7dc2-d102-421e-8a77-423503ac4784

---

## Statistics

- **Lines Added:** +0
- **Lines Removed:** -0
- **Files Changed:** 3
- **Net Change:** 0

## Files Modified
- .obsidian/plugins/al-brooks-console/src/views/Dashboard.tsx
- .spec-workflow/specs/al-brooks-console/tasks.md

## Files Created
- .obsidian/plugins/al-brooks-console/src/core/analytics.ts

---

## Artifacts

### Components

#### ConsoleComponent（Dashboard）Analytics 分区
- **Type:** React
- **Purpose:** 在同一 ItemView 内渲染 Analytics：scope 选择、日历热力图、SVG 资金曲线、策略归因 Top 列表
- **Location:** .obsidian/plugins/al-brooks-console/src/views/Dashboard.tsx
- **Props:** Props: { index: TradeIndex; strategyIndex: StrategyIndex; todayContext?: TodayContext; openFile: (path: string) => void; integrations?: PluginIntegrationRegistry; version: string }
- **Exports:** VIEW_TYPE_CONSOLE, ConsoleView

### Functions

#### filterTradesByScope
- **Purpose:** 按 scope（AccountType/All）过滤交易，用于 Analytics 视图切换
- **Location:** .obsidian/plugins/al-brooks-console/src/core/analytics.ts
- **Signature:** (trades: TradeRecord[], scope: AnalyticsScope) => TradeRecord[]
- **Exported:** Yes

#### computeDailyAgg
- **Purpose:** 按 dateIso 聚合每日 netR 与交易数，用于日历热力图与资金曲线输入
- **Location:** .obsidian/plugins/al-brooks-console/src/core/analytics.ts
- **Signature:** (trades: TradeRecord[], days: number) => DailyAgg[]
- **Exported:** Yes

#### computeEquityCurve
- **Purpose:** 将每日净值序列累计为资金曲线点（equityR）
- **Location:** .obsidian/plugins/al-brooks-console/src/core/analytics.ts
- **Signature:** (dailyDesc: DailyAgg[]) => EquityPoint[]
- **Exported:** Yes

#### computeStrategyAttribution
- **Purpose:** 从 trade.rawFrontmatter 读取策略名别名键并聚合 netR/count，同时用 StrategyIndex 解析策略卡 path 以支持跳转
- **Location:** .obsidian/plugins/al-brooks-console/src/core/analytics.ts
- **Signature:** (trades: TradeRecord[], strategyIndex: StrategyIndex, limit: number) => StrategyAttributionRow[]
- **Exported:** Yes

### Integrations

#### Integration
- **Description:** 策略归因列表中若可解析到策略卡 path，则点击打开策略卡文件
- **Frontend Component:** ConsoleComponent（Analytics → Strategy Attribution）
- **Backend Endpoint:** N/A（本地索引/Obsidian openLinkText）
- **Data Flow:** TradeIndex trades → computeStrategyAttribution → 渲染列表 → 点击 openFile(path)

