# Implementation Log: Task 17

**Summary:** 实现 Inspector + Schema Monitor（只读）：从 `Templates/属性值预设.md` 的 frontmatter 构造枚举白名单与同义值解析（CN/EN、括号、斜杠拆分等），扫描 TradeIndex trades 生成缺失字段/非法枚举值 issues，并支持生成 FixPlan（仅预览 JSON，不写入 vault）。

**Timestamp:** 2026-01-02T05:25:00.000Z
**Log ID:** b17a3e2f-8f88-4c2a-91bf-8d1f3d9b7c6a

---

## Statistics

- **Lines Added:** +0
- **Lines Removed:** -0
- **Files Changed:** 4
- **Net Change:** 0

## Files Modified

- .obsidian/plugins/al-brooks-console/src/views/Dashboard.tsx
- .spec-workflow/specs/al-brooks-console/tasks.md

## Files Created

- .obsidian/plugins/al-brooks-console/src/core/enum-presets.ts
- .obsidian/plugins/al-brooks-console/src/core/inspector.ts

---

## Artifacts

### Components

#### ConsoleComponent（Dashboard）Inspector / Schema Monitor 分区

- **Type:** React
- **Purpose:** 只读展示健康度问题列表（缺失关键字段、已结束交易缺 pnl、非法枚举值），支持点击打开对应文件；支持 FixPlan 预览（JSON 文本）但不写入。
- **Location:** .obsidian/plugins/al-brooks-console/src/views/Dashboard.tsx
- **Props:** 新增 `enumPresets?: EnumPresets`
- **Exports:** VIEW_TYPE_CONSOLE, ConsoleView

### Functions

#### createEnumPresetsFromFrontmatter

- **Purpose:** 将模板 frontmatter 中的“字段 → 枚举数组”构建为可解析的 canonical 表，并提供同义值归一（括号英文、斜杠拆分、大小写）。
- **Location:** .obsidian/plugins/al-brooks-console/src/core/enum-presets.ts
- **Signature:** (frontmatter: Record<string, unknown>) => EnumPresets
- **Exported:** Yes

#### buildInspectorIssues

- **Purpose:** 从 TradeRecord 与可选 EnumPresets 生成 issues（error/warn），覆盖缺失 date/account/ticker/outcome、已结束缺 pnl、非法枚举值等。
- **Location:** .obsidian/plugins/al-brooks-console/src/core/inspector.ts
- **Signature:** (trades: TradeRecord[], presets?: EnumPresets) => InspectorIssue[]
- **Exported:** Yes

#### buildFixPlan

- **Purpose:** 基于 EnumPresets 生成 FixPlan（仅提出“同义值 → canonical”的字段更新建议，按文件聚合），供后续 Task 18 Manager 预览/执行。
- **Location:** .obsidian/plugins/al-brooks-console/src/core/inspector.ts
- **Signature:** (trades: TradeRecord[], presets: EnumPresets) => FixPlan
- **Exported:** Yes

### Integrations

#### Enum presets injection (Obsidian vault/metadataCache)

- **Description:** ConsoleView 从 `Templates/属性值预设.md` 读取 frontmatter（优先 metadataCache，缺失则读取文件并 parseYaml），构造 EnumPresets 注入 React。
- **Frontend Component:** ConsoleView → ConsoleComponent（Inspector/Schema Monitor）
- **Backend Endpoint:** N/A（Obsidian metadataCache/vault）
- **Data Flow:** Templates frontmatter → createEnumPresetsFromFrontmatter → buildInspectorIssues/buildFixPlan → UI list + JSON preview
