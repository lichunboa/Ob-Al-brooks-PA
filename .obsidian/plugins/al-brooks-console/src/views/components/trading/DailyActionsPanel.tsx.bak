import * as React from "react";
import { Button } from "../../../ui/components/Button";

/**
 * DailyActionsPanel Propsæ¥å£
 */
export interface DailyActionsPanelProps {
    // åŠŸèƒ½æ£€æŸ¥
    can: (feature: string) => boolean;

    // ç»„ä»¶
    MarkdownBlock: React.FC<{ markdown: string; sourcePath?: string }>;

    // å¿«é€Ÿæƒ…ç»ªè®°å½•å›è°ƒ
    onQuickLog?: (type: string, note?: string) => Promise<void>;
}

/**
 * æ¯æ—¥è¡ŒåŠ¨é¢æ¿ç»„ä»¶
 * æ˜¾ç¤º4ä¸ªä»»åŠ¡ç±»åˆ«:å¿…é¡»è§£å†³ã€æŒç»­æ”¹è¿›ã€æ¯æ—¥ä¾‹è¡Œã€ç­‰å¾…ä»»åŠ¡
 */
export const DailyActionsPanel: React.FC<DailyActionsPanelProps> = ({
    can,
    MarkdownBlock,
    onQuickLog,
}) => {
    const [isLogging, setIsLogging] = React.useState(false);
    const [noteText, setNoteText] = React.useState('');

    const handleQuickLog = async (type: string) => {
        if (!onQuickLog || isLogging) return;

        setIsLogging(true);
        try {
            await onQuickLog(type, noteText);
            setNoteText(''); // æ¸…ç©ºè¾“å…¥
        } catch (error) {
            console.error('å¿«é€Ÿè®°å½•å¤±è´¥:', error);
        } finally {
            setIsLogging(false);
        }
    };

    return (
        <>
            <div
                style={{
                    margin: "18px 0 10px",
                    paddingBottom: "8px",
                    borderBottom: "1px solid var(--background-modifier-border)",
                    display: "flex",
                    alignItems: "baseline",
                    gap: "10px",
                    flexWrap: "wrap",
                }}
            >
                <div style={{ fontWeight: 700 }}>âœ… æ¯æ—¥è¡ŒåŠ¨</div>
                <div style={{ color: "var(--text-muted)", fontSize: "0.9em" }}>
                    Actions
                </div>
            </div>

            <div
                style={{
                    border: "1px solid var(--background-modifier-border)",
                    borderRadius: "10px",
                    padding: "12px",
                    marginBottom: "16px",
                    background: "var(--background-primary)",
                }}
            >
                {!can("tasks:open") ? (
                    <div style={{ color: "var(--text-faint)", fontSize: "0.9em" }}>
                        v5.0 åœ¨æ§åˆ¶å°å†…è”å±•ç¤º Tasks æŸ¥è¯¢å—;å½“å‰æœªæ£€æµ‹åˆ° Tasks
                        é›†æˆå¯ç”¨(è¯·å®‰è£…/å¯ç”¨ Tasks æ’ä»¶)ã€‚
                    </div>
                ) : null}

                <div
                    style={{
                        marginTop: "12px",
                        display: "grid",
                        gridTemplateColumns: "1fr 1fr",
                        gap: "12px",
                    }}
                >
                    <div
                        style={{
                            border: "1px solid var(--background-modifier-border)",
                            borderRadius: "10px",
                            padding: "10px",
                            background: "rgba(var(--mono-rgb-100), 0.03)",
                        }}
                    >
                        <div style={{ fontWeight: 700, marginBottom: "6px" }}>
                            ğŸ”¥ å¿…é¡»è§£å†³ (Inbox & Urgent)
                        </div>
                        <MarkdownBlock
                            markdown={`**â“ ç–‘éš¾æ‚ç—‡ (Questions)**\n\n\`\`\`tasks\nnot done\ntag includes #task/question\npath does not include Templates\nhide backlink\nshort mode\n\`\`\`\n\n**ğŸš¨ ç´§æ€¥äº‹é¡¹ (Urgent)**\n\n\`\`\`tasks\nnot done\ntag includes #task/urgent\npath does not include Templates\nhide backlink\nshort mode\n\`\`\`\n`}
                        />
                    </div>

                    <div
                        style={{
                            border: "1px solid var(--background-modifier-border)",
                            borderRadius: "10px",
                            padding: "10px",
                            background: "rgba(var(--mono-rgb-100), 0.03)",
                        }}
                    >
                        <div style={{ fontWeight: 700, marginBottom: "6px" }}>
                            ğŸ› ï¸ æŒç»­æ”¹è¿› (Improvement)
                        </div>
                        <MarkdownBlock
                            markdown={`**ğŸ§ª å›æµ‹ä»»åŠ¡ (Backtest)**\n\n\`\`\`tasks\nnot done\ntag includes #task/backtest\npath does not include Templates\nhide backlink\nshort mode\n\`\`\`\n\n**ğŸ“ å¤ç›˜ä»»åŠ¡ (Review)**\n\n\`\`\`tasks\nnot done\ntag includes #task/review\npath does not include Templates\nhide backlink\nshort mode\n\`\`\`\n\n**ğŸ“– å¾…å­¦ä¹ /é˜…è¯» (Study)**\n\n\`\`\`tasks\nnot done\n(tag includes #task/study) OR (tag includes #task/read) OR (tag includes #task/watch)\npath does not include Templates\nlimit 5\nhide backlink\nshort mode\n\`\`\`\n\n**ğŸ”¬ å¾…éªŒè¯æƒ³æ³• (Verify)**\n\n\`\`\`tasks\nnot done\ntag includes #task/verify\npath does not include Templates\nhide backlink\nshort mode\n\`\`\`\n`}
                        />
                    </div>

                    <div
                        style={{
                            border: "1px solid var(--background-modifier-border)",
                            borderRadius: "10px",
                            padding: "10px",
                            background: "rgba(var(--mono-rgb-100), 0.03)",
                        }}
                    >
                        <div style={{ fontWeight: 700, marginBottom: "6px" }}>
                            ğŸ“… æ¯æ—¥ä¾‹è¡Œ (Routine)
                        </div>
                        <MarkdownBlock
                            markdown={`**ğŸ“ æ‰‹åŠ¨æ‰“å¡ (Checklist)**\n\n- [ ] â˜€ï¸ **ç›˜å‰**:é˜…è¯»æ–°é—»,æ ‡è®°å…³é”®ä½ (S/R Levels) ğŸ” every day\n- [ ] ğŸ§˜ **ç›˜ä¸­**:æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡æƒ…ç»ª (FOMO Check) ğŸ” every day\n- [ ] ğŸŒ™ **ç›˜å**:å¡«å†™å½“æ—¥ \`å¤ç›˜æ—¥è®°\` ğŸ” every day\n\n**ğŸ§¹ æ‚é¡¹å¾…åŠ (To-Do)**\n\n\`\`\`tasks\nnot done\ntag includes #task/todo\npath does not include Templates\nhide backlink\nshort mode\nlimit 5\n\`\`\`\n`}
                        />
                    </div>

                    <div
                        style={{
                            border: "1px solid var(--background-modifier-border)",
                            borderRadius: "10px",
                            padding: "10px",
                            background: "rgba(var(--mono-rgb-100), 0.03)",
                        }}
                    >
                        <div style={{ fontWeight: 700, marginBottom: "6px" }}>
                            ğŸ› ï¸ ç­‰å¾…ä»»åŠ¡ (Maintenance)
                        </div>
                        <MarkdownBlock
                            markdown={`**ğŸ–¨ï¸ å¾…æ‰“å° (Print Queue)**\n\n\`\`\`tasks\nnot done\ntag includes #task/print\npath does not include Templates\nhide backlink\nshort mode\n\`\`\`\n\n**ğŸ“‚ å¾…æ•´ç† (Organize)**\n\n\`\`\`tasks\nnot done\ntag includes #task/organize\npath does not include Templates\nhide backlink\nshort mode\n\`\`\`\n`}
                        />
                    </div>
                </div>
            </div>
        </>
    );
};
