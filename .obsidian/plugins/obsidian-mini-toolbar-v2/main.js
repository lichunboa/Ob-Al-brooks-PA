"use strict";/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source visit the plugins github repository
*/

var Ze=Object.create;var J=Object.defineProperty,to=Object.defineProperties,eo=Object.getOwnPropertyDescriptor,oo=Object.getOwnPropertyDescriptors,no=Object.getOwnPropertyNames,rt=Object.getOwnPropertySymbols,ro=Object.getPrototypeOf,Rt=Object.prototype.hasOwnProperty,Gt=Object.prototype.propertyIsEnumerable;var zt=(t,o,e)=>o in t?J(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,F=(t,o)=>{for(var e in o||(o={}))Rt.call(o,e)&&zt(t,e,o[e]);if(rt)for(var e of rt(o))Gt.call(o,e)&&zt(t,e,o[e]);return t},At=(t,o)=>to(t,oo(o));var Yt=(t,o)=>{var e={};for(var n in t)Rt.call(t,n)&&o.indexOf(n)<0&&(e[n]=t[n]);if(t!=null&&rt)for(var n of rt(t))o.indexOf(n)<0&&Gt.call(t,n)&&(e[n]=t[n]);return e};var Kt=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports),io=(t,o)=>{for(var e in o)J(t,e,{get:o[e],enumerable:!0})},Jt=(t,o,e,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of no(o))!Rt.call(t,r)&&r!==e&&J(t,r,{get:()=>o[r],enumerable:!(n=eo(o,r))||n.enumerable});return t};var Qt=(t,o,e)=>(e=t!=null?Ze(ro(t)):{},Jt(o||!t||!t.__esModule?J(e,"default",{value:t,enumerable:!0}):e,t)),so=t=>Jt(J({},"__esModule",{value:!0}),t);var _=(t,o,e)=>new Promise((n,r)=>{var i=c=>{try{l(e.next(c))}catch(p){r(p)}},s=c=>{try{l(e.throw(c))}catch(p){r(p)}},l=c=>c.done?n(c.value):Promise.resolve(c.value).then(i,s);l((e=e.apply(t,o)).next())});var le=Kt(se=>{var fo=Object.create,st=Object.defineProperty,uo=Object.getOwnPropertyDescriptor,mo=Object.getOwnPropertyNames,ho=Object.getPrototypeOf,po=Object.prototype.hasOwnProperty,ie=t=>st(t,"__esModule",{value:!0}),go=(t,o)=>{ie(t);for(var e in o)st(t,e,{get:o[e],enumerable:!0})},xo=(t,o,e)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of mo(o))!po.call(t,n)&&n!=="default"&&st(t,n,{get:()=>o[n],enumerable:!(e=uo(o,n))||e.enumerable});return t},bo=t=>xo(ie(st(t!=null?fo(ho(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);go(se,{getApi:()=>wo,isPluginEnabled:()=>yo});var ln=bo(require("obsidian")),wo=t=>{var o;return t?(o=t.app.plugins.plugins["obsidian-icon-shortcodes"])==null?void 0:o.api:window.IconSCAPIv0},yo=t=>t.app.plugins.enabledPlugins.has("obsidian-icon-shortcodes")});var Re=Kt((vn,Te)=>{"use strict";Te.exports=function t(o,e){if(o===e)return!0;if(o&&e&&typeof o=="object"&&typeof e=="object"){if(o.constructor!==e.constructor)return!1;var n,r,i;if(Array.isArray(o)){if(n=o.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!t(o[r],e[r]))return!1;return!0}if(o.constructor===RegExp)return o.source===e.source&&o.flags===e.flags;if(o.valueOf!==Object.prototype.valueOf)return o.valueOf()===e.valueOf();if(o.toString!==Object.prototype.toString)return o.toString()===e.toString();if(i=Object.keys(o),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){var s=i[r];if(!t(o[s],e[s]))return!1}return!0}return o!==o&&e!==e}});var Jo={};io(Jo,{default:()=>wt});module.exports=so(Jo);var Ke=require("obsidian");var X=require("@codemirror/state"),D=require("@codemirror/view"),Q=require("obsidian");var St=X.StateEffect.define(),Dt=X.StateEffect.define(),kt=X.StateEffect.define(),Mt={text:[],bg:[],underline:[]},q=t=>t.map(o=>F({},o)),Pt=t=>t.map(o=>F({},o)),I=(t,o)=>{if(!t.length)return t;let e=[];for(let n of t){let r=Math.max(0,Math.min(o,n.from)),i=Math.max(0,Math.min(o,n.to));r<i&&e.push({from:r,to:i,color:n.color})}return e},it=(t,o)=>{if(!t.length)return t;let e=[];for(let n of t){let r=Math.max(0,Math.min(o,n.from)),i=Math.max(0,Math.min(o,n.to));r<i&&e.push({from:r,to:i})}return e},Zt=t=>{var o;try{let e=t.field(Q.editorViewField);if(!e)return!0;let n=e.dom;return!((o=n==null?void 0:n.closest)!=null&&o.call(n,".cm-table-widget"))}catch(e){return!0}},te=(t,o)=>{if(!t.length)return t;let e=[];for(let n of t){let r=o.mapPos(n.from,1),i=o.mapPos(n.to,-1);r>=i||e.push({from:r,to:i,color:n.color})}return e},lo=(t,o)=>{if(!t.length)return t;let e=[];for(let n of t){let r=o.mapPos(n.from,1),i=o.mapPos(n.to,-1);r>=i||e.push({from:r,to:i})}return e},ee=(t,o)=>{let{from:e,to:n,color:r}=o;if(e>=n)return t;let i=[];for(let l of t){if(l.to<=e||l.from>=n){i.push(l);continue}l.from<e&&i.push({from:l.from,to:e,color:l.color}),l.to>n&&i.push({from:n,to:l.to,color:l.color})}r!=null&&i.push({from:e,to:n,color:r}),i.sort((l,c)=>l.from-c.from||l.to-c.to);let s=[];for(let l of i){let c=s[s.length-1];c&&c.color===l.color&&c.to>=l.from?c.to=Math.max(c.to,l.to):s.push(F({},l))}return s},Et=(t,o,e)=>{let n=[];for(let r of t){if(r.to<=o||r.from>=e){n.push(r);continue}r.from<o&&n.push({from:r.from,to:o}),r.to>e&&n.push({from:e,to:r.to})}return n},co=(t,o,e)=>{let n=t.filter(s=>s.to>o&&s.from<e).sort((s,l)=>s.from-l.from),r=[],i=o;for(let s of n){let l=Math.max(s.from,o),c=Math.min(s.to,e);l>i&&r.push({from:i,to:l}),i=Math.max(i,c)}return i<e&&r.push({from:i,to:e}),r},oe=t=>{if(!t.length)return t;let o=[...t].sort((n,r)=>n.from-r.from||n.to-r.to),e=[];for(let n of o){let r=e[e.length-1];r&&r.to>=n.from?r.to=Math.max(r.to,n.to):e.push(F({},n))}return e},ao=(t,o)=>{let{from:e,to:n,enable:r}=o;if(e>=n)return t;if(r===!0){let l=Et(t,e,n);return oe([...l,{from:e,to:n}])}if(r===!1)return Et(t,e,n);let i=Et(t,e,n),s=co(t,e,n);return oe([...i,...s])},ne=(t,o,e,n)=>{let r=[];for(let i of o)r.push(D.Decoration.mark({attributes:{style:`color: ${i.color};`}}).range(i.from,i.to));for(let i of e)r.push(D.Decoration.mark({attributes:{style:`background-color: ${i.color};`}}).range(i.from,i.to));for(let i of n)r.push(D.Decoration.mark({attributes:{style:"text-decoration: underline; text-decoration-skip-ink: auto; text-underline-offset: 2px;"}}).range(i.from,i.to));return r.length?D.Decoration.set(r,!0):D.Decoration.none},re=t=>X.StateField.define({create(e){var h,u,d;let n=null;try{let m=e.field(Q.editorInfoField),a=m==null?void 0:m.file;a&&typeof a.path=="string"&&(n=a.path)}catch(m){n=null}let r=Zt(e);if(!r)return{text:[],bg:[],underline:[],decorations:D.Decoration.none,filePath:n,isMain:r,needsReload:!!n};let i=n&&t.load(n)||Mt,s=e.doc.length,l=I(q((h=i.text)!=null?h:[]),s),c=I(q((u=i.bg)!=null?u:[]),s),p=it(Pt((d=i.underline)!=null?d:[]),s),f=ne(e,l,c,p);return{text:l,bg:c,underline:p,decorations:f,filePath:n,isMain:r,needsReload:!1}},update(e,n){var g,b,O,T,R,A;let{text:r,bg:i,underline:s,filePath:l,isMain:c,needsReload:p}=e,f=l,h=!1,u=!1;try{let w=n.state.field(Q.editorInfoField),P=w==null?void 0:w.file;P&&typeof P.path=="string"?f=P.path:f=null}catch(w){f=null}let d=Zt(n.state),m=n.state.doc.length;if(f!==l){if(l&&c&&t.save(l,{text:r,bg:i,underline:s}),f&&d){let w=t.load(f)||Mt;r=I(q((g=w.text)!=null?g:[]),m),i=I(q((b=w.bg)!=null?b:[]),m),s=it(Pt((O=w.underline)!=null?O:[]),m),p=!1}else r=[],i=[],s=[],p=!!f;h=!0}if(!h&&p&&f&&d){let w=t.load(f)||Mt;r=I(q((T=w.text)!=null?T:[]),m),i=I(q((R=w.bg)!=null?R:[]),m),s=it(Pt((A=w.underline)!=null?A:[]),m),p=!1}if(!h&&d&&n.docChanged&&(r=te(r,n.changes),i=te(i,n.changes),s=lo(s,n.changes),u=!0),d)for(let w of n.effects)w.is(St)?(r=ee(r,w.value),u=!0):w.is(Dt)?(i=ee(i,w.value),u=!0):w.is(kt)&&(s=ao(s,w.value),u=!0);let a=I(r,m),y=I(i,m),x=it(s,m);r=a,i=y,s=x;let v=d?ne(n.state,r,i,s):D.Decoration.none;return f&&d&&u&&t.save(f,{text:r,bg:i,underline:s}),{text:r,bg:i,underline:s,decorations:v,filePath:f,isMain:d,needsReload:p}},provide:e=>D.EditorView.decorations.from(e,n=>n.decorations)});var ze=Qt(le()),Y=require("@codemirror/language"),Ge=require("@codemirror/state"),S=require("obsidian");var Be=require("@codemirror/state");var ce="editor-mini-toolbar-v2";var Se=require("@codemirror/view");function ct(t){return t.split("-")[0]}function ue(t){return t.split("-")[1]}function Bt(t){return["top","bottom"].includes(ct(t))?"x":"y"}function de(t){return t==="y"?"height":"width"}function ae(t){let{reference:o,floating:e,placement:n}=t,r=o.x+o.width/2-e.width/2,i=o.y+o.height/2-e.height/2,s;switch(ct(n)){case"top":s={x:r,y:o.y-e.height};break;case"bottom":s={x:r,y:o.y+o.height};break;case"right":s={x:o.x+o.width,y:i};break;case"left":s={x:o.x-e.width,y:i};break;default:s={x:o.x,y:o.y}}let l=Bt(n),c=de(l);switch(ue(n)){case"start":s[l]=s[l]-(o[c]/2-e[c]/2);break;case"end":s[l]=s[l]+(o[c]/2-e[c]/2);break}return s}var me=async(t,o,e)=>{let{placement:n="bottom",strategy:r="absolute",middleware:i=[],platform:s}=e,l=await s.getElementRects({reference:t,floating:o,strategy:r}),{x:c,y:p}=ae({...l,placement:n}),f=n,h={},u=0;for(let d=0;d<i.length;d++){let{name:m,fn:a}=i[d],{x:y,y:x,data:v,reset:g}=await a({x:c,y:p,initialPlacement:n,placement:f,strategy:r,middlewareData:h,rects:l,platform:s,elements:{reference:t,floating:o}});if(c=y??c,p=x??p,h={...h,[m]:v??{}},g){typeof g=="object"&&(g.placement&&(f=g.placement),g.rects&&(l=g.rects===!0?await s.getElementRects({reference:t,floating:o,strategy:r}):g.rects),{x:c,y:p}=ae({...l,placement:f})),d=-1;continue}}return{x:c,y:p,placement:f,strategy:r,middlewareData:h}};function vo(t){return{top:0,right:0,bottom:0,left:0,...t}}function Co(t){return typeof t!="number"?vo(t):{top:t,right:t,bottom:t,left:t}}function at(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function Z(t,o){o===void 0&&(o={});let{x:e,y:n,platform:r,rects:i,elements:s,strategy:l}=t,{boundary:c="clippingParents",rootBoundary:p="viewport",elementContext:f="floating",altBoundary:h=!1,padding:u=0}=o,d=Co(u),a=s[h?f==="floating"?"reference":"floating":f],y=await r.getClippingClientRect({element:await r.isElement(a)?a:a.contextElement||await r.getDocumentElement({element:s.floating}),boundary:c,rootBoundary:p}),x=at(await r.convertOffsetParentRelativeRectToViewportRelativeRect({rect:f==="floating"?{...i.floating,x:e,y:n}:i.reference,offsetParent:await r.getOffsetParent({element:s.floating}),strategy:l}));return{top:y.top-x.top+d.top,bottom:x.bottom-y.bottom+d.bottom,left:y.left-x.left+d.left,right:x.right-y.right+d.right}}var Oo={left:"right",right:"left",bottom:"top",top:"bottom"};function lt(t){return t.replace(/left|right|bottom|top/g,o=>Oo[o])}function To(t,o){let e=ue(t)==="start",n=Bt(t),r=de(n),i=n==="x"?e?"right":"left":e?"bottom":"top";return o.reference[r]>o.floating[r]&&(i=lt(i)),{main:i,cross:lt(i)}}var Ro={start:"end",end:"start"};function fe(t){return t.replace(/start|end/g,o=>Ro[o])}function Ao(t){let o=lt(t);return[fe(t),o,fe(o)]}var Lt=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(o){var e,n;let{placement:r,middlewareData:i,rects:s,initialPlacement:l}=o;if((e=i.flip)!=null&&e.skip)return{};let{mainAxis:c=!0,crossAxis:p=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",flipAlignment:u=!0,...d}=t,m=ct(r),y=f||(m===l||!u?[lt(l)]:Ao(l)),x=[l,...y],v=await Z(o,d),g=[],b=((n=i.flip)==null?void 0:n.overflows)||[];if(c&&g.push(v[m]),p){let{main:A,cross:w}=To(r,s);g.push(v[A],v[w])}if(b=[...b,{placement:r,overflows:g}],!g.every(A=>A<=0)){var O,T;let A=((O=(T=i.flip)==null?void 0:T.index)!=null?O:0)+1,w=x[A];if(w)return{data:{index:A,overflows:b},reset:{placement:w}};let P="bottom";switch(h){case"bestFit":{var R;let W=(R=b.slice().sort((E,M)=>E.overflows.filter(C=>C>0).reduce((C,k)=>C+k,0)-M.overflows.filter(C=>C>0).reduce((C,k)=>C+k,0))[0])==null?void 0:R.placement;W&&(P=W);break}case"initialPlacement":P=l;break}return{data:{skip:!0},reset:{placement:P}}}return{}}}};function Mo(t){let{placement:o,rects:e,value:n}=t,r=ct(o),i=["left","top"].includes(r)?-1:1,s=typeof n=="function"?n({...e,placement:o}):n,{mainAxis:l,crossAxis:c}=typeof s=="number"?{mainAxis:s,crossAxis:0}:{mainAxis:0,crossAxis:0,...s};return Bt(r)==="x"?{x:c,y:l*i}:{x:l*i,y:c}}var Nt=function(t){return t===void 0&&(t=0),{name:"offset",options:t,fn(o){let{x:e,y:n,placement:r,rects:i}=o,s=Mo({placement:r,rects:i,value:t});return{x:e+s.x,y:n+s.y,data:s}}}};function _t(t){return t?.toString()==="[object Window]"}function H(t){if(t==null)return window;if(!_t(t)){let o=t.ownerDocument;return o&&o.defaultView||window}return t}function dt(t){return H(t).getComputedStyle(t)}function B(t){return _t(t)?"":t?(t.nodeName||"").toLowerCase():""}function L(t){return t instanceof H(t).HTMLElement}function ft(t){return t instanceof H(t).Element}function Po(t){return t instanceof H(t).Node}function be(t){let o=H(t).ShadowRoot;return t instanceof o||t instanceof ShadowRoot}function mt(t){let{overflow:o,overflowX:e,overflowY:n}=dt(t);return/auto|scroll|overlay|hidden/.test(o+n+e)}function Eo(t){return["table","td","th"].includes(B(t))}function we(t){let o=navigator.userAgent.toLowerCase().includes("firefox"),e=dt(t);return e.transform!=="none"||e.perspective!=="none"||e.contain==="paint"||["transform","perspective"].includes(e.willChange)||o&&e.willChange==="filter"||o&&(e.filter?e.filter!=="none":!1)}var he=Math.min,tt=Math.max,ut=Math.round;function z(t,o){o===void 0&&(o=!1);let e=t.getBoundingClientRect(),n=1,r=1;return o&&L(t)&&(n=t.offsetWidth>0&&ut(e.width)/t.offsetWidth||1,r=t.offsetHeight>0&&ut(e.height)/t.offsetHeight||1),{width:e.width/n,height:e.height/r,top:e.top/r,right:e.right/n,bottom:e.bottom/r,left:e.left/n,x:e.left/n,y:e.top/r}}function V(t){return((Po(t)?t.ownerDocument:t.document)||window.document).documentElement}function ht(t){return _t(t)?{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}:{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function ye(t){return z(V(t)).left+ht(t).scrollLeft}function So(t){let o=z(t);return ut(o.width)!==t.offsetWidth||ut(o.height)!==t.offsetHeight}function Do(t,o,e){let n=L(o),r=V(o),i=z(t,n&&So(o)),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};if(n||!n&&e!=="fixed")if((B(o)!=="body"||mt(r))&&(s=ht(o)),L(o)){let c=z(o,!0);l.x=c.x+o.clientLeft,l.y=c.y+o.clientTop}else r&&(l.x=ye(r));return{x:i.left+s.scrollLeft-l.x,y:i.top+s.scrollTop-l.y,width:i.width,height:i.height}}function pt(t){return B(t)==="html"?t:t.assignedSlot||t.parentNode||(be(t)?t.host:null)||V(t)}function pe(t){return!L(t)||getComputedStyle(t).position==="fixed"?null:t.offsetParent}function ko(t){let o=pt(t);for(;L(o)&&!["html","body"].includes(B(o));){if(we(o))return o;o=o.parentNode}return null}function Ft(t){let o=H(t),e=pe(t);for(;e&&Eo(e)&&getComputedStyle(e).position==="static";)e=pe(e);return e&&(B(e)==="html"||B(e)==="body"&&getComputedStyle(e).position==="static"&&!we(e))?o:e||ko(t)||o}function ge(t){return{width:t.offsetWidth,height:t.offsetHeight}}function Bo(t){let{rect:o,offsetParent:e,strategy:n}=t,r=L(e),i=V(e);if(e===i)return o;let s={scrollLeft:0,scrollTop:0},l={x:0,y:0};if((r||!r&&n!=="fixed")&&((B(e)!=="body"||mt(i))&&(s=ht(e)),L(e))){let c=z(e,!0);l.x=c.x+e.clientLeft,l.y=c.y+e.clientTop}return{...o,x:o.x-s.scrollLeft+l.x,y:o.y-s.scrollTop+l.y}}function Lo(t){let o=H(t),e=V(t),n=o.visualViewport,r=e.clientWidth,i=e.clientHeight,s=0,l=0;return n&&(r=n.width,i=n.height,Math.abs(o.innerWidth/n.scale-n.width)<.01&&(s=n.offsetLeft,l=n.offsetTop)),{width:r,height:i,x:s,y:l}}function No(t){var o;let e=V(t),n=ht(t),r=(o=t.ownerDocument)==null?void 0:o.body,i=tt(e.scrollWidth,e.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),s=tt(e.scrollHeight,e.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),l=-n.scrollLeft+ye(t),c=-n.scrollTop;return dt(r||e).direction==="rtl"&&(l+=tt(e.clientWidth,r?r.clientWidth:0)-i),{width:i,height:s,x:l,y:c}}function ve(t){return["html","body","#document"].includes(B(t))?t.ownerDocument.body:L(t)&&mt(t)?t:ve(pt(t))}function Ce(t,o){var e;o===void 0&&(o=[]);let n=ve(t),r=n===((e=t.ownerDocument)==null?void 0:e.body),i=H(n),s=r?[i].concat(i.visualViewport||[],mt(n)?n:[]):n,l=o.concat(s);return r?l:l.concat(Ce(pt(s)))}function Fo(t,o){let e=o.getRootNode==null?void 0:o.getRootNode();if(t.contains(o))return!0;if(e&&be(e)){let n=o;do{if(n&&t===n)return!0;n=n.parentNode||n.host}while(n)}return!1}function _o(t){let o=z(t),e=o.top+t.clientTop,n=o.left+t.clientLeft;return{top:e,left:n,x:n,y:e,right:n+t.clientWidth,bottom:e+t.clientHeight,width:t.clientWidth,height:t.clientHeight}}function xe(t,o){return o==="viewport"?at(Lo(t)):ft(o)?_o(o):at(No(V(t)))}function Io(t){let o=Ce(pt(t)),n=["absolute","fixed"].includes(dt(t).position)&&L(t)?Ft(t):t;return ft(n)?o.filter(r=>ft(r)&&Fo(r,n)&&B(r)!=="body"):[]}function Ho(t){let{element:o,boundary:e,rootBoundary:n}=t,i=[...e==="clippingParents"?Io(o):[].concat(e),n],s=i[0],l=i.reduce((c,p)=>{let f=xe(o,p);return c.top=tt(f.top,c.top),c.right=he(f.right,c.right),c.bottom=he(f.bottom,c.bottom),c.left=tt(f.left,c.left),c},xe(o,s));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}var Vo={getElementRects:t=>{let{reference:o,floating:e,strategy:n}=t;return{reference:Do(o,Ft(e),n),floating:{...ge(e),x:0,y:0}}},convertOffsetParentRelativeRectToViewportRelativeRect:t=>Bo(t),getOffsetParent:t=>{let{element:o}=t;return Ft(o)},isElement:t=>ft(t),getDocumentElement:t=>{let{element:o}=t;return V(o)},getClippingClientRect:t=>Ho(t),getDimensions:t=>{let{element:o}=t;return ge(o)},getClientRects:t=>{let{element:o}=t;return o.getClientRects()}},Oe=(t,o,e)=>me(t,o,{platform:Vo,...e});var De=Qt(Re()),j=require("obsidian");var Ae=require("@codemirror/state"),gt=Ae.Facet.define({combine:t=>{var o,e;return{defaultPlacement:((o=t.find(n=>n.defaultPlacement))==null?void 0:o.defaultPlacement)||"top",padding:((e=t.find(n=>n.padding))==null?void 0:e.padding)||8}}});var xt=t=>t.split("-")[0];var Me=t=>t==="x"?"y":"x";var Pe=t=>["top","bottom"].includes(xt(t))?"x":"y";var G=(t,o,e)=>Math.max(t,Math.min(o,e));var jo=(t,o)=>Object.fromEntries(Object.entries(t).map(([e,n],r)=>[e,o(n,e,r)])),Wo=t=>t===void 0?t:typeof t=="number"?-t:jo(t,o=>o!==void 0?-o:o),Ee=(t={})=>({name:"shift",fn:o=>_(void 0,null,function*(){let{x:e,y:n,placement:r}=o,y=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:l=({x,y:v})=>({x,y:v}),editorMenu:c}=y,p=Yt(y,["mainAxis","crossAxis","limiter","editorMenu"]),f={x:e,y:n},h=yield Z(o,p),u=Pe(xt(r)),d=Me(u),m=f[u],a=f[d];if(i){let x=u==="y"?"top":"left",v=u==="y"?"bottom":"right",g=m+h[x],b=m-h[v];if(c){let O=yield Z(o,At(F({},p),{boundary:c.dom,padding:Wo(p.padding)}));if((d==="y"?["top","bottom"]:["left","right"]).every(R=>O[R]<=0)){let R=o.rects.floating.width,A=m+O[x]-R,w=m-O[v]+R,P=Math.abs(h[x]-O[x]),W=Math.abs(h[v]-O[v]);P>=R||W<P?m=G(g,m,A):m=G(w,m,b)}else m=G(g,m,b)}else m=G(g,m,b)}if(s){let x=d==="y"?"top":"left",v=d==="y"?"bottom":"right",g=a+h[x],b=a-h[v];a=G(g,a,b)}return l(At(F({},o),{[u]:m,[d]:a}))})});var Uo=(t=0,o=0)=>({width:0,height:0,top:o,left:t,bottom:o,right:t,x:t,y:o}),$o=t=>!!t.dom.closest(".cm-table-widget"),qo=t=>{var o,e;try{let n=((e=(o=t.root).getSelection)==null?void 0:e.call(o))||document.getSelection(),r=n==null?void 0:n.anchorNode;if(!r)return!1;let i=r.nodeType===Node.ELEMENT_NODE?r:r.parentElement;return i?!!i.closest(".cm-table-widget"):!1}catch(n){return!1}},Xo=(t,o)=>{if(!t)return null;let e={left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:0,height:t.bottom-t.top,x:t.top,y:t.left};return o&&(e.width=Math.abs(o.left-t.left)),e},zo=Uo(),It=class{constructor(o){this.view=o;this.containerEl=this.view.dom;this.toolbar=null;this.inView=!0;this.defaultPlacement=this.view.state.facet(gt).defaultPlacement;this.cachedRefRect=null;this.readFromDOM=()=>{if(!this.embedded&&this.tooltipInfo){let{start:o,end:e}=this.tooltipInfo;e&&o===e&&(e=void 0);let n=this.view.coordsAtPos(o),r=e?this.view.coordsAtPos(e):null;if(n&&r&&n.top!==r.top){let s=this.view.contentDOM.getBoundingClientRect();r={left:s.right,right:s.right,top:n.top,bottom:n.bottom}}let i=Xo(n,r);i&&(this.cachedRefRect=i,this.computePosition(i))}};this.tooltipInfo=o.state.facet(et),this.embedded=$o(o),this.virtualEl={rect:zo,getBoundingClientRect(){return this.rect}},this.maybeMeasure(),this.editorMenu={currMenu:null,evtRef:o.state.field(j.editorInfoField)}}get workspace(){return this.view.state.field(j.editorInfoField).app.workspace}shouldRemoveToolbar(o){if(this.embedded)return!0;let e=o!=null?o:this.tooltipInfo;return!((e==null?void 0:e.end)||this.editorMenu.currMenu)}onEditorMenuOpen(o){this.embedded||this.editorMenu.currMenu||(this.editorMenu.currMenu=o,this.cachedRefRect?this.computePosition(this.cachedRefRect):this.maybeMeasure(),!j.Platform.isMacOS&&this.tooltipInfo&&(this.createToolbar(),this.maybeMeasure()))}onEditorMenuClose(o){this.editorMenu.currMenu===o&&(this.editorMenu.currMenu=null),!j.Platform.isMacOS&&this.toolbar&&this.shouldRemoveToolbar()&&this.removeToolbar()}createToolbar(o){if(this.embedded)return;let e=o!=null?o:this.tooltipInfo;if(!e)return;this.removeToolbar();let n=e.create(this.containerEl),r=this.view.state.field(j.editorInfoField);if(!r||!(r!=null&&r.editor))return;let i=r.editor.offsetToPos(e.start),s=e.end?r.editor.offsetToPos(e.end):i;this.workspace.trigger(ce,n,{from:i,to:s},r.editor,r),this.toolbar=n}removeToolbar(){!this.toolbar||(this.toolbar.hide(),this.toolbar=null)}update(o){if(this.embedded||qo(this.view)){this.toolbar&&this.removeToolbar();return}let e=o.state.facet(et),n=e!==this.tooltipInfo&&!(0,De.default)(e,this.tooltipInfo);n&&(this.tooltipInfo=e,this.shouldRemoveToolbar()?this.removeToolbar():e&&!this.toolbar&&this.createToolbar(e));let r=n||o.geometryChanged,i=o.state.facet(gt);i.defaultPlacement!=this.defaultPlacement&&(i.defaultPlacement=this.defaultPlacement),r&&this.maybeMeasure()}destroy(){this.editorMenu.currMenu=null,this.removeToolbar(),this.toolbar=null,this.view.state.field(j.editorInfoField).app.workspace.offref(this.editorMenu.evtRef)}computePosition(o){return _(this,null,function*(){if(this.embedded||!this.toolbar)return;this.virtualEl.rect=o;let{padding:e}=this.view.state.facet(gt),{x:n,y:r}=yield Oe(this.virtualEl,this.toolbar.dom,{placement:this.defaultPlacement,middleware:[Nt({mainAxis:5}),Lt({padding:e,boundary:this.view.scrollDOM}),Ee({padding:e,boundary:this.view.scrollDOM,editorMenu:this.editorMenu.currMenu})]});Object.assign(this.toolbar.dom.style,{top:"0",left:"0",transform:`translate(${Math.round(n)}px,${Math.round(r)}px)`})})}maybeMeasure(){this.embedded||(this.view.inView&&this.toolbar&&this.view.requestMeasure({read:this.readFromDOM}),this.inView!=this.view.inView&&(this.inView=this.view.inView,this.inView))}},Go=Se.ViewPlugin.fromClass(It,{eventHandlers:{scroll(){this.maybeMeasure()}}}),ke=Go;var et=Be.Facet.define({enables:[ke],combine:t=>{var o;return(o=t.filter(e=>e!=null).first())!=null?o:null}});var Ht=require("obsidian");var Fe=t=>{let o=je(t);if(!o)return;let e=o.getSelection();window.navigator.clipboard.writeText(o.getSelection()),o.replaceSelection("",e)},_e=t=>{let o=je(t);!o||window.navigator.clipboard.writeText(o==null?void 0:o.getSelection())},Ie=t=>{t.commands.executeCommandById("editor:toggle-bold",t)},He=t=>{t.commands.executeCommandById("editor:toggle-strikethrough",t)};var Ve=t=>{t.commands.executeCommandById("editor:toggle-italics",t)},je=t=>{let{editor:o}=t.field(Ht.editorInfoField);return o},Vt=t=>{var o,e;try{let n=t.field(Ht.editorInfoField),r=n==null?void 0:n.editor,i=(e=(o=r==null?void 0:r.cm)!=null?o:r==null?void 0:r.cmEditor)!=null?e:r==null?void 0:r.cm6;return i&&typeof i.dispatch=="function"?i:null}catch(n){return null}},bt={Gray:"#9B9A97",Brown:"#64473A",Orange:"#D9730D",Yellow:"#DFAB01",Green:"#0F7B6C",Blue:"#0B6E99",Purple:"#6940A5",Pink:"#AD1A72",Red:"#E03E3E"},We=["Default",...Object.keys(bt)],Yo={Gray:"#EAEAEA",Brown:"#EEE0DA",Orange:"#FAEBDD",Yellow:"#FBF3DB",Green:"#DDEDEA",Blue:"#DDEBF1",Purple:"#EAE4F2",Pink:"#F4DFEB",Red:"#FBE4E4"},jt=["Default",...Object.keys(Yo)],Le=(t,o)=>{let e=Vt(t);if(!e)return;let n=e.state.selection.main;if(n.empty)return;let r=n.from,i=n.to;e.dispatch({effects:St.of({from:r,to:i,color:o})})},Ue=(t,o)=>{if(o==="Default")return Le(t,null);let e=bt[o];e&&Le(t,e)},Ne=(t,o)=>{let e=Vt(t);if(!e)return;let n=e.state.selection.main;if(n.empty)return;let r=n.from,i=n.to;e.dispatch({effects:Dt.of({from:r,to:i,color:o})})},$e=(t,o)=>{if(o==="Default")return Ne(t,null);let e=`var(--mtv2-bg-${o.toLowerCase()})`;Ne(t,e)},qe=(t,o)=>{let e=Vt(t);if(!e)return;let n=e.state.selection.main;if(n.empty)return;let r=n.from,i=n.to;e.dispatch({effects:kt.of({from:r,to:i,enable:o})})};var Xe=(t,o)=>{let e=t.selection.ranges[0];if(!e)return null;let{anchor:n,head:r,empty:i}=e,[s,l]=[n,r].sort(),c=t.doc.lineAt(e.from).number!==t.doc.lineAt(e.to).number;return{start:s,end:i?void 0:l,create:f=>new Ut(f).addSmallButton(u=>u.setIcon("scissors").onClick(()=>Fe(t))).addSmallButton(u=>u.setIcon("copy").onClick(()=>_e(t))).addSmallButton(u=>u.setIcon("bold").onClick(()=>Ie(o))).addSmallButton(u=>u.setIcon("italic").onClick(()=>Ve(o))).addSmallButton(u=>u.setIcon("strikethrough").onClick(()=>He(o))).addSmallButton(u=>u.setIcon("underline").setTooltip("Underline").onClick(()=>qe(t))).addSmallButton(u=>u.setDropdownIcon("palette").setTooltip("Text color").setOptionsList(We).setOnSelectOption(d=>Ue(t,d)).setOnSelectBgOption(d=>$e(t,d)).onClick(()=>{}))}},Ko=t=>Ge.StateField.define({create:o=>Xe(o,t),update:(o,e)=>!e.docChanged&&!e.selection?o:Xe(e.state,t),provide:o=>et.from(o)}),Ye=t=>[Ko(t)],Wt=class extends S.BaseComponent{constructor(e){super();this.disabled=!1;this.dropdownOptions=[];this.onSelectOption=null;this.onSelectBgOption=null;this.menuOpened=!1;this.button=new S.ButtonComponent(e)}setDisabled(e){return this.button.setDisabled(e),this.disabled=e,this}setIcon(e){this.button.setIcon(e);let r,i;if(!this.button.buttonEl.querySelector("svg")&&(r=(0,ze.getApi)())&&(i=r.getIcon(e,!1))){let s={width:14,height:14};typeof i=="string"?this.button.buttonEl.createDiv({text:i,attr:s}):(Object.assign(i,s),this.button.buttonEl.appendChild(i))}return this}setClass(e){return this.button.setClass(e),this}setDropdownText(e){var c;let n=this.button.buttonEl.createDiv("mini-toolbar-v2-text"),r=this.button.buttonEl.createDiv("mini-toolbar-v2-icon-with-text");(0,S.setIcon)(r,"chevron-down");let i=(c=e.doc.lineAt(e.selection.ranges[0].from))==null?void 0:c.from,s=(0,Y.syntaxTree)(e).resolveInner(i+1),l=s.type.prop(Y.tokenClassNodeProp);return n.setText(this.detectFormat(l,s)||"Text"),this}setDropdownIcon(e="highlighter"){let n=this.button.buttonEl.createDiv("mini-toolbar-v2-highlight-icon"),r=this.button.buttonEl.createDiv("mini-toolbar-v2-icon-with-icon");return(0,S.setIcon)(n,e),(0,S.setIcon)(r,"chevron-down"),this}detectFormat(e,n){var r;if(!e)return"Text";if(e.includes("strong"))return"Bold";if(e.includes("em"))return"Italic";if(e.includes("strikethrough"))return"Strike";if(e.contains("hmd-codeblock"))return"CodeBlock";if(e.contains("hmd-inline-code"))return"Code";if(e.contains("formatting-header")){let i=e.match(/header-\d{1,}/);if(i)return"Heading "+i[0].slice(-1)}if(e.contains("formatting-list")||e.contains("hmd-list-indent")){if(n!=null&&n.parent){let i=(r=n.parent)==null?void 0:r.type.prop(Y.lineClassNodeProp);if(i!=null&&i.contains("HyperMD-task-line"))return"To-do list"}if(e.contains("formatting-list-ol"))return"Numbered list";if(e.contains("formatting-list-ul"))return"Bulleted list"}}setTooltip(e){return this.button.setTooltip(e),this}setOptionsList(e){return this.dropdownOptions=e,this}setOnSelectOption(e){return this.onSelectOption=e,this}setOnSelectBgOption(e){return this.onSelectBgOption=e,this}onClick(e){return this.dropdownOptions.length>0?(this.button.onClick(n=>this.showEditMenu(n)),this):(this.button.onClick(e),this)}showEditMenu(e){var l,c,p;if(console.log(this.menuOpened),this.menuOpened=!this.menuOpened,!this.menuOpened)return;this.menu=new S.Menu,this.menu.onHide(()=>{this.menuOpened=!1});let n=this.menu.dom;n&&((l=n.addClass)==null||l.call(n,"mini-toolbar-v2-color-menu"));let r=e.currentTarget,i=(c=e.currentTarget)==null?void 0:c.getBoundingClientRect(),s={x:i.left-6,y:i.bottom+6};for(let f=0;f<((p=this.dropdownOptions)==null?void 0:p.length);f++){let h=this.dropdownOptions[f],u=h==="Default"?"var(--text-normal)":bt[h];this.menu.addItem(d=>{var x,v,g,b;d.setTitle("A").onClick(()=>{var O;(O=this.onSelectOption)==null||O.call(this,h)});let m=h==="Default"?"Default":`${h} text`,a=d.dom;(x=a==null?void 0:a.setAttr)==null||x.call(a,"title",m),(v=a==null?void 0:a.setAttr)==null||v.call(a,"data-color-kind","text"),(g=a==null?void 0:a.addClass)==null||g.call(a,"mini-toolbar-v2-color-item");let y=(b=a==null?void 0:a.querySelector)==null?void 0:b.call(a,".menu-item-title");y&&(y.style.color=`${u}`)})}this.menu.addSeparator();for(let f=0;f<jt.length;f++){let h=jt[f],u=h==="Default"?"transparent":`var(--mtv2-bg-${h.toLowerCase()})`;this.menu.addItem(d=>{var x,v,g,b;d.setTitle("A").onClick(()=>{var O;(O=this.onSelectBgOption)==null||O.call(this,h)});let m=h==="Default"?"Default background":`${h} background`,a=d.dom;(x=a==null?void 0:a.setAttr)==null||x.call(a,"title",m),(v=a==null?void 0:a.setAttr)==null||v.call(a,"data-color-kind","background"),(g=a==null?void 0:a.addClass)==null||g.call(a,"mini-toolbar-v2-color-item");let y=(b=a==null?void 0:a.querySelector)==null?void 0:b.call(a,".menu-item-title");y&&(u==="transparent"?y.style.removeProperty("background-color"):y.style.backgroundColor=u,y.style.color="var(--text-normal)")})}this.menu.setParentElement(r).showAtPosition(s),requestAnimationFrame(()=>{var a,y,x,v,g;let f=(a=this.menu)==null?void 0:a.dom;if(!f)return;let h=f.querySelector(".menu-scroller")||f.querySelector(".menu-scroll")||f,u=Array.from(h.querySelectorAll(".menu-group"));if(u.length===1){let b=h.createDiv({cls:"menu-group"}),O=Array.from(u[0].querySelectorAll(".menu-item"));for(let T of O)((x=(y=T.getAttr)==null?void 0:y.call(T,"data-color-kind"))!=null?x:T.getAttribute("data-color-kind"))==="background"&&b.appendChild(T);u[0].insertAdjacentElement("afterend",b),u=[u[0],b]}let[d,m]=u.length>=2?u:[u[0],void 0];if(d){let b=h.createDiv({cls:"mini-toolbar-v2-color-header",text:"Text colour"});h.insertBefore(b,d),(v=d.addClass)==null||v.call(d,"mini-toolbar-v2-color-grid")}if(m){let b=h.createDiv({cls:"mini-toolbar-v2-color-header",text:"Background"});h.insertBefore(b,m),(g=m.addClass)==null||g.call(m,"mini-toolbar-v2-color-grid")}})}then(e){return e(this),this}},Ut=class extends S.Component{constructor(e){super();this.unloading=!1;this.dom=e.createDiv({cls:"cm-mini-toolbar-v2"},n=>n.style.position="absolute"),this.smallBtnContainer=this.dom}addSmallButton(e){return e(new Wt(this.smallBtnContainer)),this}hide(){return this.unload(),this.unloading?this:(this.unloading=!0,this.dom.detach(),this.unloading=!1,this)}};var wt=class extends Ke.Plugin{constructor(){super(...arguments);this.colorData={};this.persistHandle=null}onload(){return _(this,null,function*(){console.log("loading MiniToolbar");let e=yield this.loadData();e&&typeof e=="object"&&(this.colorData=e);let r=re({load:i=>this.colorData[i],save:(i,s)=>{this.colorData[i]=s,this.queuePersistence()}});this.registerEditorExtension([...Ye(this.app),r]),this.registerMarkdownPostProcessor((i,s)=>{if(i.closest(".markdown-source-view"))return;let l=this.colorData[s.sourcePath];!l||this.applyColorsToReadingView(i,l)})})}applyColorsToReadingView(e,n){var b,O,T,R,A,w,P,W;let r=(b=n.text)!=null?b:[],i=(O=n.bg)!=null?O:[],s=(T=n.underline)!=null?T:[];if(!r.length&&!i.length&&!s.length)return;let l=$t(r),c=$t(i),p=$t(s),f=new ot(l),h=new ot(c),u=new ot(p),d=e.ownerDocument||document,m=d.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),a=0,y=E=>{let M=E.parentElement;return M?!!M.closest("code, pre, .math, .cm-inline-code, .cm-codeblock"):!1},x=(E,M)=>{for(let C of E)if(C.from<=M&&M<C.to)return C.color;return null},v=(E,M)=>{for(let C of E)if(C.from<=M&&M<C.to)return!0;return!1},g;for(;g=m.nextNode();){let E=g,M=(R=E.nodeValue)!=null?R:"",C=a,k=C+M.length;if(a=k,!M.length||y(E))continue;f.advanceTo(C),h.advanceTo(C),u.advanceTo(C);let U=new Set;if(U.add(C),U.add(k),f.addBoundaries(U,C,k),h.addBoundaries(U,C,k),u.addBoundaries(U,C,k),U.size===2)continue;let yt=Array.from(U).sort((N,$)=>N-$),nt=[];for(let N=0;N<yt.length-1;N++){let $=yt[N],qt=yt[N+1];if($>=qt)continue;let Je=$-C,Qe=qt-C,Ct=M.slice(Je,Qe);if(!Ct)continue;let Ot=(w=(A=f.rangeAt($))==null?void 0:A.color)!=null?w:null,Tt=(W=(P=h.rangeAt($))==null?void 0:P.color)!=null?W:null,Xt=!!u.rangeAt($);if(!Ot&&!Tt&&!Xt)nt.push(d.createTextNode(Ct));else{let K=d.createElement("span");Ot&&(K.style.color=Ot),Tt&&(K.style.backgroundColor=Tt),Xt&&(K.style.textDecoration="underline"),K.textContent=Ct,nt.push(K)}}let vt=E.parentNode;if(!(!vt||!nt.length)){for(let N of nt)vt.insertBefore(N,E);vt.removeChild(E)}}}queuePersistence(){this.persistHandle||(this.persistHandle=window.setTimeout(()=>_(this,null,function*(){this.persistHandle=null,yield this.saveData(this.colorData)}),300))}onunload(){return _(this,null,function*(){this.persistHandle&&(window.clearTimeout(this.persistHandle),this.persistHandle=null),Object.keys(this.colorData).length&&(yield this.saveData(this.colorData))})}},$t=t=>t.length>1?[...t].sort((o,e)=>o.from-e.from):t,ot=class{constructor(o){this.ranges=o;this.index=0}advanceTo(o){for(;this.index<this.ranges.length&&this.ranges[this.index].to<=o;)this.index++}addBoundaries(o,e,n){if(!this.ranges.length)return;let r=this.index;r>0&&this.ranges[r-1].to>e&&r--;for(let i=r;i<this.ranges.length;i++){let s=this.ranges[i];if(s.from>=n)break;s.to>e&&(o.add(Math.max(e,s.from)),o.add(Math.min(n,s.to)))}}rangeAt(o){if(!this.ranges.length)return null;let e=this.index;e>=this.ranges.length&&(e=this.ranges.length-1),e>0&&this.ranges[e-1].to>o&&e--;for(let n=e;n<this.ranges.length;n++){let r=this.ranges[n];if(r.from>o)break;if(r.to>o)return this.index=n,r}return null}};
