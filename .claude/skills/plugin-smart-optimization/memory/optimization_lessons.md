# Optimization Lessons (优化经验库)

> **来源**: 整合了 `trading-console-plugin-maintainer` 技能包的实战经验

## 写入规则

- 每次完成一次优化任务后,追加 1-5 条
- 每条都要可复用:包含"触发条件 → 处理动作 → 验收方式"
- 如果是高频坑,除了这里,还要同步到 `references/gotchas.md`

---

## Known Lessons

### 2026-01-07: 初始化技能包

- **触发**: 创建新的优化技能包
- **动作**: 基于 MCP 工具生态设计标准流程
- **验收**: 技能包结构完整,文档清晰
- **经验**: 使用智能工具比外部自动化工具更灵活、更安全

---

### 2026-01-07: 整合 trading-console-plugin-maintainer 经验

- **触发**: 发现已有维护技能包包含大量实战经验
- **动作**: 将实战经验整合到优化技能包中
- **验收**: gotchas.md 和 checklists.md 包含完整的实战经验
- **经验**: 
  - Dashboard.tsx 大文件编辑需要特殊处理
  - 必须用稳定锚点夹住删除范围
  - 全局搜索验证命中数是关键
  - 外部集成必须做 capability 检测
  - 禁止使用 window.prompt/confirm

---

### 大文件(Dashboard.tsx)安全编辑

- **触发**: 需要移动/删除较大 UI 块、合并 tab 内容
- **动作**: 用模块标题做锚点,小步删除/替换;每一步都跑 `npm run build`
- **验收**: 关键词命中数符合预期(例如只剩 1 个 `✅ 每日行动`),构建通过
- **经验**: 
  - 任何删除/替换都必须包含完整起止边界
  - 不跨越组件定义边界
  - 删除后立即验证,不要积累问题

---

### 文件损坏的恢复策略

- **触发**: 出现大面积 TSX 解析错误(通常是"半截 JSX"或 import 区被污染)
- **动作**: 优先单文件回退到"已知干净提交/最后一次通过 build 的版本",再在干净基线重做变更
- **验收**: 错误面板恢复到变更前水平,`npm run build` 通过
- **经验**:
  - 立刻停止继续编辑
  - 不要试图"修复"300+ 错误
  - 回滚后重新用稳定锚点操作

---

### 外部集成必须可降级

- **触发**: 依赖 Tasks / QuickAdd 等外部插件的功能块
- **动作**: 统一 `can("...")` 检测;缺失时展示提示而不是报错
- **验收**: 未安装外部插件时页面不崩溃,用户能理解下一步如何启用
- **经验**:
  - 始终走 capability 检测
  - 集成缺失时渲染提示文案,不要隐藏整个模块
  - 不使用 window.prompt/confirm,改用 Modal

---

### 重复块处理

- **触发**: UI 里出现重复模块;或搜索关键词出现 2+ 次
- **动作**: 
  1. 全局搜索统计命中数
  2. 每次只删除一个命中点
  3. 删除后重新统计
  4. 用"命中数 == 目标数"作为验收
- **验收**: 关键词只在预期位置出现
- **经验**:
  - 不靠肉眼验证,必须用搜索统计
  - 先全局搜索模块标题统计出现次数
  - 逐个定位确认所属页面

---

## 待添加经验

(每次优化后在此追加)

