# ğŸ“ æ·±åº¦ä¼˜åŒ–éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ (Requirement Spec v2.2)

> **é¡¹ç›®**: Al Brooks Trader Console v2.2
> **ç±»å‹**: Deep Dive Upgrade (æ·±åº¦æ¶æ„å‡çº§)
> **åŸºå‡†**: ä¾æ® 2026-01-17 æ·±åº¦è®¨è®ºä¸ç”Ÿæ€åˆ†æ
> **æ ¸å¿ƒç›®æ ‡**: å®ç° "Template-Driven" (æ¨¡æ¿é©±åŠ¨) ä¸ "Context-Aware" (ä¸Šä¸‹æ–‡æ„ŸçŸ¥) çš„æ™ºèƒ½é—­ç¯ã€‚

---

## 1. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å·®å¼‚å¯¹æ¯” (Logic Contrast)

### 1.1 ç­–ç•¥æ¨è (Strategy Recommendation)
| ç‰¹æ€§ | v2.1 (Current) | v2.2 (Target) | éªŒæ”¶æ ‡å‡† |
| :--- | :--- | :--- | :--- |
| **æ•°æ®æº** | `Strategy Index` (ä»…æ–‡ä»¶åä¸ç®€å•çš„ tags) | `Strategy Repository` å…¨é‡ Frontmatter | å¿…é¡»æ­£ç¡®è§£æ `risk_level`, `timeframe`, `direction` å­—æ®µã€‚ |
| **åŒ¹é…é€»è¾‘** | ä»…åŸºäº `patterns_observed` (å½¢æ€) çš„ç®€å•å­—ç¬¦ä¸²åŒ¹é… | **åŠ æƒå¤šç»´åŒ¹é…**: <br>1. Pattern (å¿…ä¸­)<br>2. Direction (è¿‡æ»¤åå‘)<br>3. Timeframe (åŠ åˆ†)<br>4. Risk (åŠ åˆ†) | 5åˆ†é’Ÿå‘¨æœŸçš„åšå¤šäº¤æ˜“ï¼Œ**ä¸¥ç¦**æ¨èæ—¥çº¿çº§åˆ«çš„åšç©ºç­–ç•¥ã€‚ |

### 1.2 æ¯æ—¥å¤ç›˜ (Daily Review)
| ç‰¹æ€§ | v2.1 (Current) | v2.2 (Target) | éªŒæ”¶æ ‡å‡† |
| :--- | :--- | :--- | :--- |
| **Checklist** | æ’ä»¶å†…éƒ¨çš„ Stateï¼Œåˆ·æ–°å³ä¸¢å¤±ï¼Œä¸ç¬”è®°æ— å…³ | **åŒå‘ç»‘å®š (Two-way Sync)** | æ’ä»¶å†…å‹¾é€‰ "æ‰‹æœºé™éŸ³"ï¼Œ`Daily Journal.md` å¯¹åº”çš„ `[ ]` å˜ä¸º `[x]`ã€‚ |
| **å…¥å£** | åªèƒ½é€šè¿‡ Dashboard é“¾æ¥æ‰“å¼€ | **Dashboard åµŒå…¥** | åœ¨ TradingHub ç›´æ¥æ˜¾ç¤ºä»Šæ—¥ Checklistï¼Œæ— ç¼æ‰§è¡Œã€‚ |

### 1.3 æ•°æ®éªŒè¯ (Data Validation)
| ç‰¹æ€§ | v2.1 (Current) | v2.2 (Target) | éªŒæ”¶æ ‡å‡† |
| :--- | :--- | :--- | :--- |
| **æšä¸¾ç®¡ç†** | ç¡¬ç¼–ç åœ¨ `constants.ts` æˆ– `schema.ts` | **åŠ¨æ€åŠ è½½ (Hot Load)** | ä¿®æ”¹ `Templates/å±æ€§å€¼é¢„è®¾.md` åï¼Œæ’ä»¶å¿…é¡»è‡ªåŠ¨æ›´æ–°ä¸‹æ‹‰æ¡†é€‰é¡¹ï¼Œæ— éœ€æ”¹ä»£ç ã€‚ |
| **é»˜è®¤å€¼** | ç¡¬ç¼–ç  | è¯»å–æ¨¡æ¿ä¸­çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºé»˜è®¤å€¼ | - |

---

## 2. è¯¦ç»†åŠŸèƒ½éœ€æ±‚ (Functional Requirements)

### 2.1 åŠ¨æ€ Schema å¼•æ“ (Dynamic Schema Engine)
*   **REQ-001**: ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå¿…é¡»è‡ªåŠ¨æ‰«æ `Templates/å±æ€§å€¼é¢„è®¾.md`ã€‚
*   **REQ-002**: è§£ææ‰€æœ‰ List ç±»å‹çš„ Frontmatter å­—æ®µï¼ˆå¦‚ `setup_category`, `execution_quality`ï¼‰ï¼Œæ„å»ºå…¨å±€ `SchemaContext`ã€‚
*   **REQ-003**: æä¾› `getOptions(field)` API ä¾› UI ç»„ä»¶è°ƒç”¨ã€‚

### 2.2 äº¤æ˜“ä¸­å¿ƒ (Trading Hub)
*   **REQ-004 (R-Calc)**: è¾“å…¥ `Entry`, `Stop` æ—¶ï¼Œå®æ—¶è®¡ç®— Risk Amountã€‚è¾“å…¥ `Target` æ—¶ï¼Œå®æ—¶è®¡ç®— R Valueã€‚
*   **REQ-005 (Market Cycle)**: é¡¶éƒ¨å¢åŠ  "Market Cycle" ä¸‹æ‹‰æ¡†ï¼Œä¿®æ”¹åç›´æ¥é€šè¿‡ `ActionService` æ›´æ–°å½“å‰ Trade Note çš„ Frontmatterã€‚

### 2.3 å­¦ä¹ æ¨¡å— (Learn)
*   **REQ-006 (Context Push)**: ç›‘å¬ `TradingHub.currentSetup`ã€‚
*   **REQ-007**: è°ƒç”¨ SRS æ’ä»¶ APIï¼Œæœç´¢ `tags` åŒ…å«è¯¥ Setup ä¸” `due` (åˆ°æœŸ) çš„å¡ç‰‡ã€‚

---

## 3. æŠ€æœ¯æ¶æ„è¦æ±‚ (Technical Constraints)

1.  **Upgrade Only Policy**: ä¸¥ç¦åˆ é™¤ç°æœ‰åŠŸèƒ½ï¼ˆå¦‚ç°æœ‰çš„ Dashboard å¸ƒå±€æ¶æ„ï¼‰ã€‚
2.  **Typesafety**: æ‰€æœ‰ä» fileCache è¯»å–çš„ `any` ç±»å‹æ•°æ®å¿…é¡»ç»è¿‡ Zod æ ¡éªŒï¼ˆæ²¿ç”¨ v2.2.0 çš„ Zod æ¶æ„ï¼‰ã€‚
3.  **Safe Edit**: æ–‡ä»¶ä¿®æ”¹å¿…é¡»ä½¿ç”¨ `ActionService`ï¼Œä¸¥ç¦ç›´æ¥è°ƒç”¨ Obsidian API ä¿®æ”¹æ–‡ä»¶ï¼ˆä¸ºäº†ä¿è¯åŒ…å« Undo/Backup é€»è¾‘ï¼‰ã€‚

---

## 4. æµ‹è¯•è®¡åˆ’ (Test Plan)

*   **Unit Test**: å¯¹ `SchemaLoader`, `StrategyMatcherV2` å¿…é¡»æœ‰ 100% è¦†ç›–ç‡çš„ Jest æµ‹è¯•ã€‚
*   **Integration Test**: æ‰‹åŠ¨éªŒè¯ Checklist åŒå‘åŒæ­¥ï¼ˆå› æ¶‰åŠ Markdown AST è§£æï¼Œæ‰‹åŠ¨éªŒè¯æ›´å¯é ï¼‰ã€‚
