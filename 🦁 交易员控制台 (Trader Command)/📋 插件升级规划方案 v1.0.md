# ğŸ“‹ Al Brooks Console æ’ä»¶å‡çº§è§„åˆ’æ–¹æ¡ˆ v1.0

> **ç›®æ ‡**ï¼šå°†æ’ä»¶ä»"æ¡†æ¶å·²æ­å¥½ä½†æ•°æ®åº•åº§ä¸ç¨³"å‡çº§åˆ°"è¾¾åˆ° v5.0 DataviewJS æ§åˆ¶å°çš„æ™ºèƒ½è”åŠ¨æ•ˆæœ"
>
> **è§„åˆ’æ—¥æœŸ**ï¼š2026-01-03
> **é¢„è®¡å‘¨æœŸ**ï¼š4 å‘¨ï¼ˆåˆ† 4 ä¸ªé˜¶æ®µï¼‰
> **æˆåŠŸæ ‡å‡†**ï¼šæ’ä»¶èƒ½å®Œå…¨æ›¿ä»£ DataviewJS æ§åˆ¶å°ï¼Œä¸”æ€§èƒ½æ›´ä¼˜ã€ç»´æŠ¤æ€§æ›´å¥½

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜è¯Šæ–­æ€»ç»“

åŸºäºæ·±åº¦åˆ†æï¼Œå½“å‰æ’ä»¶å­˜åœ¨ **3 ä¸ªè‡´å‘½é—®é¢˜** å’Œ **5 ä¸ªé‡è¦ä¼˜åŒ–ç‚¹**ï¼š

### è‡´å‘½é—®é¢˜ï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰

1. **P0-Aï¼šæ¨¡æ¿æ±¡æŸ“äº¤æ˜“ç´¢å¼•**

   - ç°è±¡ï¼š`Templates/å•ç¬”äº¤æ˜“æ¨¡ç‰ˆ (Trade Note).md` è¢«å½“æˆçœŸå®äº¤æ˜“
   - å½±å“ï¼šæ‰€æœ‰ç»Ÿè®¡ã€åˆ—è¡¨ã€ä»Šæ—¥ç­›é€‰è¢«æ±¡æŸ“
   - æ ¹å› ï¼šTradeIndex åªæ£€æŸ¥ tag `PA/Trade`ï¼Œæœªæ’é™¤ Templates è·¯å¾„

2. **P0-Bï¼šæ—¥æœŸè§£æå¤±æ•ˆ**

   - ç°è±¡ï¼šäº¤æ˜“æ–‡ä»¶å `251219_0036_å®ç›˜_ES.md` â†’ dateIso = `251219_0036`ï¼ˆé ISOï¼‰
   - å½±å“ï¼šæ’åºã€ä»Šæ—¥ç­›é€‰ã€æ—¥èšåˆã€èµ„é‡‘æ›²çº¿å…¨éƒ¨é”™ä¹±
   - æ ¹å› ï¼šç¼ºå°‘ filename â†’ ISO date çš„è§£æå…œåº•

3. **P0-Cï¼šå¯¼å‡ºå‘½ä»¤ç¼ºå¤±**
   - ç°è±¡ï¼šæ–‡æ¡£é‡Œè¯´æœ‰"å¯¼å‡ºç´¢å¼•å¿«ç…§"å‘½ä»¤ï¼Œä½†æ’ä»¶é‡Œæœªæ³¨å†Œ
   - å½±å“ï¼šæ— æ³•éªŒè¯æ’ä»¶è¾“å‡ºæ­£ç¡®æ€§ï¼Œåªèƒ½ç”¨ç¦»çº¿è„šæœ¬ï¼ˆä¼šäº§ç”Ÿè¯¯åˆ¤ï¼‰
   - æ ¹å› ï¼š`exportIndexSnapshot()` å‡½æ•°å­˜åœ¨ä½†æœªæ³¨å†Œä¸ºå‘½ä»¤

### é‡è¦ä¼˜åŒ–ç‚¹ï¼ˆå½±å“æ™ºèƒ½è”åŠ¨ï¼‰

4. **P1-Aï¼špnl/r å£å¾„æ··æ·†**

   - ç°è±¡ï¼šç»Ÿè®¡åªçœ‹ pnl æ•°å€¼ï¼Œä½†ç”¨æˆ·å¯èƒ½åœ¨ pnl å­—æ®µé‡Œå­˜ R å€æ•°
   - å½±å“ï¼šUI æ–‡æ¡ˆã€ç»Ÿè®¡å£å¾„ã€å¯¼å‡ºæ•°æ®ä¸ä¸€è‡´

5. **P1-Bï¼šToday Context æ—¥è®°è¯†åˆ«ä¸ç¨³**

   - ç°è±¡ï¼šä»Šæ—¥ç¬”è®°è·¯å¾„/å‘½åå¤šæ ·ï¼Œç°æœ‰è§„åˆ™å¯èƒ½æ‰¾ä¸åˆ°
   - å½±å“ï¼š"ä»Šæ—¥å¸‚åœºå‘¨æœŸ â†’ ç­–ç•¥æ¨è"è”åŠ¨æ–­æ‰

6. **P1-Cï¼šç­–ç•¥åŒ¹é…ç¼ºå°‘è°ƒè¯•èƒ½åŠ›**

   - ç°è±¡ï¼šå½¢æ€ â†’ ç­–ç•¥çš„æ˜ å°„å¯èƒ½å¤±è´¥ï¼Œä½†æ— åé¦ˆ
   - å½±å“ï¼šäº¤æ˜“ä¸­å¿ƒçš„"æ™ºèƒ½æ¨è"çœ‹èµ·æ¥ä¸å·¥ä½œ

7. **P1-Dï¼šCourse/Memory æ•°æ®åŠ è½½æ…¢**

   - ç°è±¡ï¼šDashboard åˆæ¬¡æ‰“å¼€æ—¶ï¼ŒCourse/Memory å¯èƒ½å¡é¡¿
   - å½±å“ï¼šä½“éªŒä¸å¦‚ DataviewJSï¼ˆåè€…æœ‰ç¼“å­˜ï¼‰

8. **P1-Eï¼šManager æ‰¹é‡æ“ä½œç¼ºå°‘äº‹åŠ¡**
   - ç°è±¡ï¼šæ‰¹é‡ä¿®æ”¹ frontmatter æ—¶ï¼Œéƒ¨åˆ†æˆåŠŸ/éƒ¨åˆ†å¤±è´¥ä¼šç•™ä¸‹ä¸ä¸€è‡´çŠ¶æ€
   - å½±å“ï¼šç”¨æˆ·ä¸æ•¢ç”¨ Manager åŠŸèƒ½

---

## ğŸ“… åˆ†é˜¶æ®µæ‰§è¡Œè®¡åˆ’

### ğŸš¨ é˜¶æ®µ 1ï¼šç´§æ€¥ä¿®å¤ï¼ˆWeek 1ï¼Œ3-5 å¤©ï¼‰

**ç›®æ ‡**ï¼šä¿®å¤ 3 ä¸ªè‡´å‘½é—®é¢˜ï¼Œè®©æ’ä»¶"èƒ½ç”¨ä¸”å¯éªŒè¯"

#### ä»»åŠ¡ 1.1ï¼šä¿®å¤äº¤æ˜“ç´¢å¼•æ±¡æŸ“ï¼ˆP0-Aï¼‰

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/platforms/obsidian/obsidian-trade-index.ts`

**æ”¹åŠ¨ç‚¹**ï¼š

```typescript
// åœ¨ getCandidateFilesForInitialBuild() å’Œ indexFile() ä¸­å¢åŠ è·¯å¾„è¿‡æ»¤
const EXCLUDED_PATHS = ["Templates/", "Exports/", ".obsidian/"];

function shouldExcludePath(path: string): boolean {
  return EXCLUDED_PATHS.some(
    (prefix) => path.startsWith(prefix) || path.includes(`/${prefix}`)
  );
}

// åœ¨ä¸¤ä¸ªå‡½æ•°ä¸­è°ƒç”¨ï¼š
if (shouldExcludePath(file.path)) return false; // æˆ– return this.db.delete(file.path);
```

**éªŒè¯**ï¼š

- å¯¼å‡ºå¿«ç…§ï¼Œæ£€æŸ¥ `trades.length` æ˜¯å¦ç­‰äº"çœŸå®äº¤æ˜“æ•°"ï¼ˆä¸å«æ¨¡æ¿ï¼‰
- Dashboard ä»Šæ—¥ç»Ÿè®¡æ•°é‡æ­£ç¡®

---

#### ä»»åŠ¡ 1.2ï¼šä¿®å¤æ—¥æœŸè§£æï¼ˆP0-Bï¼‰

**æ–‡ä»¶**ï¼šåŒä¸Š + æ–°å¢ `src/core/date-parser.ts`

**æ”¹åŠ¨ç‚¹**ï¼š

1. æ–°å»º `date-parser.ts`ï¼š

```typescript
export function parseTradeDate(options: {
  frontmatterDate?: unknown;
  filename: string;
  mtime?: number;
}): string {
  // 1. ä¼˜å…ˆ frontmatter.date
  if (typeof options.frontmatterDate === "string") {
    const d = options.frontmatterDate.trim();
    if (/^\d{4}-\d{2}-\d{2}$/.test(d)) return d;
  }

  // 2. è§£æ filename
  const basename = options.filename.replace(/\.md$/i, "");

  // 2a. YYMMDD_* â†’ 20YY-MM-DD
  const m1 = basename.match(/^(\d{2})(\d{2})(\d{2})_/);
  if (m1) {
    const [, yy, mm, dd] = m1;
    return `20${yy}-${mm}-${dd}`;
  }

  // 2b. YYYY-MM-DD_*
  const m2 = basename.match(/^(\d{4})-(\d{2})-(\d{2})/);
  if (m2) return m2[0];

  // 2c. YYYYMMDD_*
  const m3 = basename.match(/^(\d{4})(\d{2})(\d{2})_/);
  if (m3) {
    const [, yyyy, mm, dd] = m3;
    return `${yyyy}-${mm}-${dd}`;
  }

  // 3. å…œåº•ï¼šmtime â†’ local date
  if (typeof options.mtime === "number") {
    const d = new Date(options.mtime);
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, "0");
    const dd = String(d.getDate()).padStart(2, "0");
    return `${yyyy}-${mm}-${dd}`;
  }

  // 4. æœ€ç»ˆå…œåº•
  return basename.substring(0, 10);
}
```

2. åœ¨ TradeIndex çš„ `indexFile()` ä¸­è°ƒç”¨ï¼š

```typescript
import { parseTradeDate } from "../../core/date-parser";

const dateIso = parseTradeDate({
  frontmatterDate: getFirstFieldValue(fm, FIELD_ALIASES.date),
  filename: file.name,
  mtime: file.stat?.mtime,
});
```

**éªŒè¯**ï¼š

- æ‰‹åŠ¨æµ‹è¯• `251219_0036_å®ç›˜_ES.md` â†’ åº”å¾—åˆ° `2025-12-19`
- Dashboard "ä»Šæ—¥äº¤æ˜“"èƒ½æ­£ç¡®ç­›é€‰

---

#### ä»»åŠ¡ 1.3ï¼šæ³¨å†Œå¯¼å‡ºå‘½ä»¤ï¼ˆP0-Cï¼‰

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/main.ts`

**æ”¹åŠ¨ç‚¹**ï¼š

```typescript
// åœ¨ onload() ä¸­ï¼ŒaddCommand é‚£é‡Œè¡¥ä¸€æ¡ï¼š
this.addCommand({
  id: "export-index-snapshot",
  name: "å¯¼å‡ºç´¢å¼•å¿«ç…§ï¼ˆJSONï¼‰",
  callback: () => {
    void this.exportIndexSnapshot();
  },
});
```

**éªŒè¯**ï¼š

- å‘½ä»¤é¢æ¿æœ"å¯¼å‡ºç´¢å¼•å¿«ç…§"èƒ½æ‰¾åˆ°
- æ‰§è¡Œååœ¨ `Exports/al-brooks-console/snapshot_*.json` çœ‹åˆ°æ–°æ–‡ä»¶
- `meta.pluginVersion` æ˜¾ç¤ºæ’ä»¶ç‰ˆæœ¬å·ï¼ˆè€Œé `dry-run-from-legacy`ï¼‰

---

#### ä»»åŠ¡ 1.4ï¼šå›å½’æµ‹è¯•åŸºçº¿

**ç›®æ ‡**ï¼šå»ºç«‹"ä¿®å¤å vs DataviewJS æ§åˆ¶å°"çš„å¯¹æ¯”åŸºçº¿

**æ­¥éª¤**ï¼š

1. ç”¨ DataviewJS æ§åˆ¶å°å¯¼å‡ºä¸€ä»½ `pa-db-export.json`ï¼ˆä½œä¸º legacy åŸºçº¿ï¼‰
2. ç”¨ä¿®å¤åçš„æ’ä»¶å¯¼å‡º `snapshot_*.json`
3. å¯¹æ¯”ï¼š
   - `trades.length`ï¼ˆåº”è¯¥ä¸€è‡´ï¼Œä¸”ä¸å«æ¨¡æ¿ï¼‰
   - éšæœºæŠ½ 5 ç¬”äº¤æ˜“ï¼Œæ£€æŸ¥ `dateIso/pnl/outcome/accountType` æ˜¯å¦ä¸€è‡´
   - `statsByAccountType` çš„ `Live/Demo/Backtest` æ•°é‡ä¸ netProfit æ˜¯å¦ä¸€è‡´

**äº§å‡º**ï¼šä¸€ä»½"å›å½’å¯¹æ¯”æŠ¥å‘Š.md"ï¼Œåˆ—å‡ºæ‰€æœ‰ä¸ä¸€è‡´çš„ç‚¹ï¼ˆå¦‚æœè¿˜æœ‰ï¼‰

---

### ğŸ§  é˜¶æ®µ 2ï¼šæ™ºèƒ½è”åŠ¨ä¼˜åŒ–ï¼ˆWeek 2ï¼Œ5-7 å¤©ï¼‰

**ç›®æ ‡**ï¼šä¿®å¤ P1 çº§ä¼˜åŒ–ç‚¹ï¼Œè®©"äº¤æ˜“ä¸­å¿ƒ â†” ç­–ç•¥ä»“åº“ â†” ä»Šæ—¥ç¬”è®°"çš„è”åŠ¨ç¨³å®šå·¥ä½œ

#### ä»»åŠ¡ 2.1ï¼šæ˜ç¡® pnl/r å£å¾„ï¼ˆP1-Aï¼‰

**å†³ç­–ç‚¹**ï¼šéœ€è¦ä½ ç¡®è®¤ä¸€ä¸ªé—®é¢˜ âš ï¸

ä½ çš„ `å‡€åˆ©æ¶¦/net_profit` å­—æ®µé‡Œï¼Œåˆ°åº•å­˜çš„æ˜¯ï¼š

- **A. é‡‘é¢**ï¼ˆå¦‚ `$123.45` æˆ– `123.45`ï¼‰
- **B. R å€æ•°**ï¼ˆå¦‚ `2.5R` æˆ– `2.5`ï¼‰

**æ–¹æ¡ˆ Aï¼ˆé‡‘é¢å£å¾„ï¼‰**ï¼š

- æ’ä»¶ä¿æŒç°çŠ¶ï¼ˆpnl = é‡‘é¢ï¼‰
- å¯¼å‡ºå¿«ç…§è¡¥å…… `r` å­—æ®µï¼ˆå·²å®ç°ï¼‰
- Dashboard UI æ˜¾ç¤ºï¼š`$123.45` + `(2.5R)`

**æ–¹æ¡ˆ Bï¼ˆR å£å¾„ï¼‰**ï¼š

- ä¿®æ”¹æ’ä»¶ï¼š
  - `TradeRecord.pnl` æ”¹åä¸º `TradeRecord.r`
  - stats ç»Ÿè®¡å£å¾„æ”¹ä¸º"R ç´¯è®¡"
  - UI æ–‡æ¡ˆç»Ÿä¸€æ˜¾ç¤º `2.5R`ï¼ˆä¸æ˜¾ç¤ºé‡‘é¢ï¼‰
- é‡‘é¢å¦å­˜ä¸€ä¸ªå­—æ®µ `cash_pnl`ï¼ˆå¯é€‰ï¼‰

**å»ºè®®**ï¼š**æ–¹æ¡ˆ A**ï¼ˆé‡‘é¢å£å¾„ï¼‰ï¼Œå› ä¸ºï¼š

- æ§åˆ¶å° v5.0 å¯¼å‡ºçš„ç¤ºä¾‹é‡Œï¼Œpnl å’Œ r æ˜¯åˆ†å¼€çš„
- é‡‘é¢æ›´ç›´è§‚ï¼Œé€‚åˆå®ç›˜ç»Ÿè®¡
- R å€æ•°å¯ä»¥ä½œä¸º"åˆ†æç»´åº¦"å•ç‹¬è®¡ç®—

---

#### ä»»åŠ¡ 2.2ï¼šå¢å¼º Today Contextï¼ˆP1-Bï¼‰

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/platforms/obsidian/obsidian-today-context.ts`

**æ”¹åŠ¨ç‚¹**ï¼š

1. æ‰©å±•æ—¥è®°è¯†åˆ«è§„åˆ™ï¼š

```typescript
// å¢åŠ æ›´å¤šæ—¥æœŸæ ¼å¼å€™é€‰
const patterns = [
  `${yyyy}-${mm}-${dd}`, // 2026-01-03
  `${yyyy}${mm}${dd}`, // 20260103
  `${yy}${mm}${dd}`, // 260103
  `${mm}${dd}`, // 0103ï¼ˆå½“æœˆï¼‰
  `${yyyy}å¹´${mm}æœˆ${dd}æ—¥`, // 2026å¹´01æœˆ03æ—¥
];

// å¢åŠ è·¯å¾„ä¼˜å…ˆçº§ï¼šDaily/ > æ ¹ç›®å½• > å…¶ä»–
```

2. å¢åŠ "æ‰‹åŠ¨æŒ‡å®šä»Šæ—¥ç¬”è®°"é…ç½®é¡¹ï¼ˆSettingsï¼‰ï¼š

```typescript
// settings.ts
export interface AlBrooksConsoleSettings {
  // ... ç°æœ‰å­—æ®µ
  todayNotePath?: string; // å¯é€‰ï¼šæ‰‹åŠ¨æŒ‡å®šä»Šæ—¥ç¬”è®°è·¯å¾„ï¼ˆè¦†ç›–è‡ªåŠ¨è¯†åˆ«ï¼‰
}
```

**éªŒè¯**ï¼š

- å¤šç§æ—¥æœŸæ ¼å¼çš„ç¬”è®°éƒ½èƒ½è¢«è¯†åˆ«
- Dashboard é¡¶éƒ¨æ˜¾ç¤º"ä»Šæ—¥å¸‚åœºå‘¨æœŸï¼šå¼ºè¶‹åŠ¿"ï¼ˆæ¥è‡ªæ—¥è®°ï¼‰

---

#### ä»»åŠ¡ 2.3ï¼šç­–ç•¥åŒ¹é…è°ƒè¯•é¢æ¿ï¼ˆP1-Cï¼‰

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/views/Dashboard.tsx`

**æ”¹åŠ¨ç‚¹**ï¼š
åœ¨ Dashboard çš„"äº¤æ˜“ä¸­å¿ƒ"åŒºåŸŸï¼Œå¢åŠ ä¸€ä¸ª"è°ƒè¯•ä¿¡æ¯"æŠ˜å é¢æ¿ï¼š

```tsx
<details style={{ marginTop: "8px", fontSize: "0.85em", opacity: 0.7 }}>
  <summary>ğŸ” ç­–ç•¥åŒ¹é…è°ƒè¯•</summary>
  <div style={{ padding: "8px", background: "var(--background-secondary)" }}>
    <div>ç­–ç•¥ç´¢å¼•æ€»æ•°ï¼š{strategies.length}</div>
    <div>ä»Šæ—¥äº¤æ˜“å½¢æ€ï¼š{todayTrade?.patterns?.join(", ") || "æ— "}</div>
    <div>åŒ¹é…åˆ°çš„ç­–ç•¥ï¼š{matchedStrategy?.canonicalName || "æ— åŒ¹é…"}</div>
    {!matchedStrategy && todayTrade?.patterns && (
      <div style={{ color: "var(--text-warning)" }}>
        âš ï¸ æœªæ‰¾åˆ°åŒ¹é…ç­–ç•¥ï¼Œè¯·æ£€æŸ¥ç­–ç•¥å¡ç‰‡çš„ patterns_observed å­—æ®µ
      </div>
    )}
  </div>
</details>
```

**éªŒè¯**ï¼š

- ç”¨æˆ·èƒ½çœ‹åˆ°"ä¸ºä»€ä¹ˆç­–ç•¥æ²¡æ¨è"
- å¦‚æœå½¢æ€åç§°ä¸åŒ¹é…ï¼Œèƒ½å¿«é€Ÿå‘ç°å¹¶ä¿®æ­£

---

#### ä»»åŠ¡ 2.4ï¼šCourse/Memory ç¼“å­˜ä¼˜åŒ–ï¼ˆP1-Dï¼‰

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/core/course.ts` å’Œ `memory.ts`

**æ”¹åŠ¨ç‚¹**ï¼š

1. å¢åŠ å†…å­˜ç¼“å­˜ï¼ˆ5 åˆ†é’Ÿ TTLï¼‰ï¼š

```typescript
let courseCacheData: CourseSnapshot | null = null;
let courseCacheTs = 0;
const CACHE_TTL = 5 * 60 * 1000; // 5 åˆ†é’Ÿ

export async function buildCourseSnapshot(...): Promise<CourseSnapshot> {
  const now = Date.now();
  if (courseCacheData && now - courseCacheTs < CACHE_TTL) {
    return courseCacheData;
  }

  // åŸæœ‰æ‰«æé€»è¾‘
  const result = { ... };

  courseCacheData = result;
  courseCacheTs = now;
  return result;
}
```

2. å¢åŠ "å¼ºåˆ¶åˆ·æ–°"æŒ‰é’®ï¼ˆDashboard UIï¼‰

**éªŒè¯**ï¼š

- Dashboard æ‰“å¼€é€Ÿåº¦ä» 3s â†’ <1s
- ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®åï¼Œèƒ½é‡æ–°æ‰«æ

---

### ğŸ”§ é˜¶æ®µ 3ï¼šç®¡ç†æ¨¡å—å¼ºåŒ–ï¼ˆWeek 3ï¼Œ3-5 å¤©ï¼‰

**ç›®æ ‡**ï¼šè®© Managerã€Inspector åŠŸèƒ½æ›´å®‰å…¨ã€å¯å›æ»š

#### ä»»åŠ¡ 3.1ï¼šManager äº‹åŠ¡åŒ–ï¼ˆP1-Eï¼‰

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/core/manager.ts`

**æ”¹åŠ¨ç‚¹**ï¼š

```typescript
export async function applyFixPlanWithTransaction(
  plan: FixPlan,
  vault: Vault
): Promise<{
  success: boolean;
  errors: string[];
  backups: Record<string, string>;
}> {
  const backups: Record<string, string> = {};
  const errors: string[] = [];

  // 1. å…ˆå¤‡ä»½æ‰€æœ‰å¾…ä¿®æ”¹æ–‡ä»¶
  for (const path of plan.affectedPaths) {
    const file = vault.getAbstractFileByPath(path);
    if (file instanceof TFile) {
      backups[path] = await vault.read(file);
    }
  }

  // 2. æ‰§è¡Œä¿®æ”¹
  try {
    for (const op of plan.operations) {
      await applyOperation(op, vault);
    }
    return { success: true, errors: [], backups };
  } catch (e) {
    // 3. å¤±è´¥å›æ»š
    errors.push(e.message);
    for (const [path, content] of Object.entries(backups)) {
      const file = vault.getAbstractFileByPath(path) as TFile;
      await vault.modify(file, content);
    }
    return { success: false, errors, backups };
  }
}
```

**éªŒè¯**ï¼š

- æ‰¹é‡ä¿®æ”¹ 10 ä¸ªæ–‡ä»¶ï¼Œæ•…æ„è®©ç¬¬ 5 ä¸ªå¤±è´¥ â†’ å‰ 4 ä¸ªåº”è¯¥è¢«å›æ»š
- Dashboard æ˜¾ç¤º"å·²å›æ»š"æç¤º

---

#### ä»»åŠ¡ 3.2ï¼šInspector é—®é¢˜åˆ†çº§

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/core/inspector.ts`

**æ”¹åŠ¨ç‚¹**ï¼š
ç»™é—®é¢˜å¢åŠ ä¸¥é‡æ€§ç­‰çº§ï¼š

```typescript
export type IssueSeverity = "critical" | "warning" | "info";

export interface InspectorIssue {
  // ... ç°æœ‰å­—æ®µ
  severity: IssueSeverity;
  autoFixable: boolean; // æ˜¯å¦å¯ä»¥è‡ªåŠ¨ä¿®å¤
}
```

**UI æ•ˆæœ**ï¼š

- ğŸ”´ Criticalï¼šç¼ºå°‘å¿…å¡«å­—æ®µï¼ˆdate/pnl/outcomeï¼‰
- ğŸŸ¡ Warningï¼šæ—¥æœŸæ ¼å¼å¼‚å¸¸ã€pnl ç±»å‹ä¸å¯¹
- ğŸ”µ Infoï¼šå»ºè®®è¡¥å……å­—æ®µï¼ˆticker/setupï¼‰

**éªŒè¯**ï¼š

- Dashboard æŒ‰ä¸¥é‡æ€§åˆ†ç»„æ˜¾ç¤ºé—®é¢˜
- ç”¨æˆ·èƒ½ä¸€é”®ä¿®å¤æ‰€æœ‰"å¯è‡ªåŠ¨ä¿®å¤"çš„é—®é¢˜

---

### ğŸš€ é˜¶æ®µ 4ï¼šæ€§èƒ½ä¸ä½“éªŒï¼ˆWeek 4ï¼Œ3-5 å¤©ï¼‰

**ç›®æ ‡**ï¼šè¾¾åˆ°æˆ–è¶…è¶Š DataviewJS æ§åˆ¶å°çš„ä½“éªŒ

#### ä»»åŠ¡ 4.1ï¼šç´¢å¼•å¢é‡æ›´æ–°

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/platforms/obsidian/obsidian-trade-index.ts`

**æ”¹åŠ¨ç‚¹**ï¼š
ç°æœ‰çš„ `rebuild()` æ˜¯å…¨é‡æ‰«æï¼›æ”¹ä¸ºï¼š

- åˆæ¬¡åŠ è½½ï¼šå…¨é‡æ‰«æ
- åç»­æ›´æ–°ï¼šä»…é‡æ–°ç´¢å¼•å˜æ›´çš„æ–‡ä»¶ï¼ˆå·²æœ‰ `queueReindex` æœºåˆ¶ï¼Œä½†å¯ä»¥ä¼˜åŒ–å»é‡ï¼‰

**éªŒè¯**ï¼š

- ä¿®æ”¹ 1 ä¸ªäº¤æ˜“ç¬”è®° â†’ Dashboard åˆ·æ–°è€—æ—¶ <100msï¼ˆè€Œéé‡æ–°æ‰«æå…¨åº“ï¼‰

---

#### ä»»åŠ¡ 4.2ï¼šDashboard çŠ¶æ€æŒä¹…åŒ–

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/views/Dashboard.tsx`

**æ”¹åŠ¨ç‚¹**ï¼š
ç”¨ `localStorage` ä¿å­˜ç”¨æˆ·é€‰æ‹©ï¼š

- å½“å‰é€‰ä¸­çš„ Analytics Scopeï¼ˆLive/Demo/Allï¼‰
- æŠ˜å é¢æ¿çš„å±•å¼€/æ”¶èµ·çŠ¶æ€
- ç­›é€‰å™¨è®¾ç½®

**éªŒè¯**ï¼š

- å…³é—­ Dashboard å†æ‰“å¼€ï¼ŒçŠ¶æ€ä¿æŒä¸å˜

---

#### ä»»åŠ¡ 4.3ï¼šç§»åŠ¨ç«¯é€‚é…æ£€æŸ¥

**æ–‡ä»¶**ï¼š`.obsidian/plugins/al-brooks-console/src/views/Dashboard.tsx`ï¼ˆCSSï¼‰

**æ”¹åŠ¨ç‚¹**ï¼š
å¢åŠ å“åº”å¼å¸ƒå±€ï¼š

```css
@media (max-width: 768px) {
  .console-grid {
    grid-template-columns: 1fr; /* å•åˆ—å¸ƒå±€ */
  }
  .stats-card {
    font-size: 0.9em;
  }
}
```

**éªŒè¯**ï¼š

- åœ¨ iPad/iPhone ä¸Šæ‰“å¼€ Dashboardï¼Œå¸ƒå±€ä¸é”™ä½

---

#### ä»»åŠ¡ 4.4ï¼šæœ€ç»ˆå›å½’æµ‹è¯•

**æ­¥éª¤**ï¼š

1. ç”¨çœŸå®æ•°æ®ï¼ˆ50+ æ¡äº¤æ˜“ï¼‰æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. å¯¹æ¯” DataviewJS æ§åˆ¶å°è¾“å‡ºï¼ˆç”¨å¯¼å‡ºå¿«ç…§ï¼‰
3. æ€§èƒ½åŸºå‡†ï¼š
   - Dashboard æ‰“å¼€è€—æ—¶ <2s
   - äº¤æ˜“åˆ—è¡¨æ¸²æŸ“ 100 æ¡ <1s
   - å¯¼å‡ºå¿«ç…§è€—æ—¶ <1s

**äº§å‡º**ï¼š

- æœ€ç»ˆæµ‹è¯•æŠ¥å‘Š
- å·²çŸ¥é™åˆ¶æ¸…å•ï¼ˆå¦‚æœæœ‰ï¼‰
- ç”¨æˆ·è¿ç§»æŒ‡å—

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡ï¼ˆå¦‚ä½•åˆ¤æ–­"å®Œæˆäº†"ï¼‰

### æ ¸å¿ƒæŒ‡æ ‡

- âœ… äº¤æ˜“ç´¢å¼•å‡†ç¡®ç‡ = 100%ï¼ˆä¸å«æ¨¡æ¿ã€æ—¥æœŸæ­£ç¡®ï¼‰
- âœ… ä»Šæ—¥è”åŠ¨æˆåŠŸç‡ â‰¥ 95%ï¼ˆèƒ½æ‰¾åˆ°ä»Šæ—¥ç¬”è®° + æ­£ç¡®ç­›é€‰ä»Šæ—¥äº¤æ˜“ï¼‰
- âœ… ç­–ç•¥åŒ¹é…å‘½ä¸­ç‡ â‰¥ 80%ï¼ˆæœ‰å½¢æ€çš„äº¤æ˜“èƒ½åŒ¹é…åˆ°ç­–ç•¥ï¼‰
- âœ… å¯¼å‡ºå¿«ç…§ä¸ legacy çš„ä¸€è‡´æ€§ â‰¥ 99%ï¼ˆå…è®¸ 1% çš„ç²¾åº¦è¯¯å·®ï¼‰

### ä½“éªŒæŒ‡æ ‡

- âš¡ Dashboard æ‰“å¼€è€—æ—¶ <2sï¼ˆé¦–æ¬¡ï¼‰ / <500msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰
- ğŸ”„ å®æ—¶åˆ·æ–°å»¶è¿Ÿ <200ms
- ğŸ“± ç§»åŠ¨ç«¯å¯ç”¨æ€§ â‰¥ 90%ï¼ˆæ ¸å¿ƒåŠŸèƒ½åœ¨æ‰‹æœºä¸Šèƒ½ç”¨ï¼‰

### ç¨³å®šæ€§æŒ‡æ ‡

- ğŸ›¡ï¸ Manager æ“ä½œå¤±è´¥å›æ»šç‡ = 100%
- ğŸ“¦ å†…å­˜å ç”¨ <50MBï¼ˆå¸¸é©»ï¼‰
- ğŸ› å·²çŸ¥ Bug æ•°é‡ = 0ï¼ˆè‡³å°‘ P0/P1 çº§åˆ«ï¼‰

---

## ğŸ› ï¸ å®æ–½å»ºè®®

### å¼€å‘ç¯å¢ƒå‡†å¤‡

1. ç¡®ä¿ TypeScript/esbuild ç¯å¢ƒæ­£å¸¸
2. å‡†å¤‡æµ‹è¯•æ•°æ®é›†ï¼š
   - è‡³å°‘ 20 æ¡çœŸå®äº¤æ˜“ç¬”è®°
   - è‡³å°‘ 5 ä¸ªç­–ç•¥å¡ç‰‡
   - è‡³å°‘ 1 ä»½ä»Šæ—¥ç¬”è®°ï¼ˆå« market_cycleï¼‰
3. å®‰è£… Obsidian Inspector æ’ä»¶ï¼ˆè°ƒè¯•ç”¨ï¼‰

### åˆ†æ”¯ç­–ç•¥

```
main (å½“å‰ç¨³å®šç‰ˆ)
  â†“
feature/phase-1-critical-fixes (Week 1)
  â†“
feature/phase-2-smart-linking (Week 2)
  â†“
feature/phase-3-manager-hardening (Week 3)
  â†“
feature/phase-4-performance (Week 4)
  â†“
main (åˆå¹¶åå‘å¸ƒ v2.0)
```

### æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**ï¼šdate-parserã€field-mapper ç­‰çº¯å‡½æ•°
- **é›†æˆæµ‹è¯•**ï¼šTradeIndex + StrategyIndex çš„è”åŠ¨
- **E2E æµ‹è¯•**ï¼šDashboard æ ¸å¿ƒæµç¨‹ï¼ˆæ‰‹åŠ¨ï¼‰

### æ–‡æ¡£æ›´æ–°

æ¯ä¸ªé˜¶æ®µå®Œæˆåï¼Œæ›´æ–°ï¼š

1. `README.md`ï¼ˆç”¨æˆ·æ–‡æ¡£ï¼‰
2. `CHANGELOG.md`ï¼ˆç‰ˆæœ¬å†å²ï¼‰
3. `.obsidian/plugins/al-brooks-console/manifest.json`ï¼ˆç‰ˆæœ¬å·ï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆä»Šå¤©ï¼‰

1. **ç¡®è®¤ 2 ä¸ªå†³ç­–ç‚¹**ï¼ˆæˆ‘éœ€è¦ä½ å›ç­”ï¼‰ï¼š

   - Q1ï¼šä½ çš„ `net_profit/pnl` å­—æ®µå­˜çš„æ˜¯é‡‘é¢è¿˜æ˜¯ Rï¼Ÿ
   - Q2ï¼šä½ çš„äº¤æ˜“ç¬”è®°æ—¥æœŸæ¥æºä¼˜å…ˆçº§ï¼Ÿï¼ˆfrontmatter.date > æ–‡ä»¶å > mtimeï¼‰

2. **åˆ›å»ºé¡¹ç›®ç›®å½•**ï¼š

```bash
mkdir -p .spec-workflow/specs/console-plugin-upgrade
```

3. **å¼€å§‹é˜¶æ®µ 1**ï¼ˆæˆ‘å¯ä»¥ç›´æ¥å¼€å§‹æ”¹ä»£ç ï¼Œæˆ–è€…ä½ æƒ³å…ˆçœ‹æˆ‘å†™çš„éœ€æ±‚æ–‡æ¡£ï¼‰

### æœ¬å‘¨ç›®æ ‡ï¼ˆWeek 1ï¼‰

- å®Œæˆ P0-A/B/C ä¸‰ä¸ªè‡´å‘½é—®é¢˜ä¿®å¤
- å¯¼å‡ºä¸€ä»½"ä¿®å¤å"çš„å¿«ç…§ï¼Œä¸ legacy å¯¹æ¯”
- å¦‚æœä¸€è‡´æ€§ >95%ï¼Œè¿›å…¥é˜¶æ®µ 2

---

## ğŸ“ é™„å½•ï¼šéœ€è¦ä½ ç¡®è®¤çš„ä¿¡æ¯

ä¸ºäº†é¿å…"ä¿®é”™æ–¹å‘"ï¼Œè¯·ä½ ç¡®è®¤ï¼š

1. **pnl å£å¾„**ï¼šé‡‘é¢ or Rï¼Ÿï¼ˆæ¨èï¼šé‡‘é¢ï¼‰
2. **æ—¥æœŸæ¥æºä¼˜å…ˆçº§**ï¼šæ˜¯å¦ frontmatter.date > filename > mtimeï¼Ÿ
3. **ä»Šæ—¥ç¬”è®°è·¯å¾„**ï¼šæ˜¯å¦å›ºå®šåœ¨ `Daily/` ä¸‹ï¼Ÿè¿˜æ˜¯å¯èƒ½åœ¨æ ¹ç›®å½•ï¼Ÿ
4. **ç­–ç•¥ä»“åº“è·¯å¾„**ï¼šæ˜¯å¦å›ºå®šä¸º `ç­–ç•¥ä»“åº“ (Strategy Repository)/`ï¼Ÿ
5. **æ˜¯å¦éœ€è¦ä¿ç•™ DataviewJS æ§åˆ¶å°**ï¼šæ’ä»¶å®Œæˆåï¼Œæ—§æ§åˆ¶å°æ˜¯å¦è¿˜è¦ç”¨ï¼Ÿï¼ˆå»ºè®®ï¼šä¿ç•™ 1 ä¸ªæœˆä½œä¸ºå¯¹ç…§ï¼‰

---

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœä½ æƒ³ç”¨ MCP spec-workflow æ¥ç®¡ç†è¿™ä¸ªå‡çº§é¡¹ç›®ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ›å»ºï¼š
>
> - Requirements æ–‡æ¡£ï¼ˆè¯¦ç»†éœ€æ±‚ï¼‰
> - Design æ–‡æ¡£ï¼ˆæŠ€æœ¯è®¾è®¡ï¼‰
> - Tasks æ–‡æ¡£ï¼ˆå¯æ‰§è¡Œä»»åŠ¡æ¸…å•ï¼‰
>
> è¿™æ ·æ¯ä¸ªä»»åŠ¡éƒ½æœ‰æ¸…æ™°çš„"å®Œæˆæ ‡å‡†"å’Œ"å®ç°æç¤º"ï¼Œæ›´å®¹æ˜“è¿½è¸ªè¿›åº¦ã€‚
