# TradeCat Architecture V2 (Stabilized)

## ğŸŒŸ ç³»ç»Ÿæ¦‚è§ˆ

æœ¬æ¶æ„é‡‡ç”¨"å®˜æ–¹æ ¸å¿ƒ + æ¨¡å—åŒ–æ‰©å±•"çš„è®¾è®¡æ¨¡å¼ï¼Œè§£å†³äº†ä¹‹å‰ç³»ç»Ÿæ··ä¹±ã€ç»´æŠ¤å›°éš¾çš„é—®é¢˜ã€‚

### æ ¸å¿ƒç†å¿µ
1.  **Keep Core Clean**: ä¿æŒ `backend/tradecat-core` ä¸å®˜æ–¹ä»“åº“é«˜åº¦ä¸€è‡´ï¼Œæ–¹ä¾¿åç»­å‡çº§ã€‚
2.  **Extensions as Services**: æ‰€æœ‰å®šåˆ¶åŠŸèƒ½ï¼ˆå¦‚ç¾è‚¡ã€ç‰¹å®šç­–ç•¥ï¼‰ä½œä¸ºç‹¬ç«‹å¾®æœåŠ¡è¿è¡Œã€‚
3.  **Unified Data**: æ•°æ®ç»Ÿä¸€æ±‡èšåœ¨ TimescaleDBï¼Œä¸Šå±‚åº”ç”¨ï¼ˆTelegram/Obsidianï¼‰å¯¹æ­¤æ— æ„ŸçŸ¥ã€‚

---

## ğŸ—ï¸ æ¶æ„å›¾

```mermaid
graph TD
    subgraph "External"
        Binance[Binance API]
        Yahoo[Yahoo Finance]
        User[User / Obsidian]
        Telegram[Telegram App]
    end

    subgraph "TradeCat Core (backend/tradecat-core)"
        DataService[Data Service] --> Binance
        TradingService[Trading Service] -->|Read/Calc| DB[(TimescaleDB)]
        TelegramService[Telegram Service] --> Telegram
        start_sh[start_mac.sh] --> DataService
        start_sh --> TradingService
        start_sh --> TelegramService
    end

    subgraph "Extensions (Custom)"
        StockService[Stock Service] --> Yahoo
        StockService -->|Write Fake Crypto Format| DB
        
        APIGateway[API Gateway] -->|Read| DB
        APIGateway --> User
        
        start_sh --> StockService
        start_sh --> APIGateway
    end
    
    DataService -->|Write Raw| DB
    TelegramService -->|Read Indicators| DB
    TradingService -->|Write Indicators| DB
```

## ğŸ“‚ ç›®å½•ç»“æ„ (ç²¾ç®€ç‰ˆ)

```text
backend/tradecat-core/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ .env                # ç»Ÿä¸€é…ç½®æ–‡ä»¶ (Token, DB URL)
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ data-service/       # [å®˜æ–¹] åŠ å¯†è´§å¸é‡‡é›† (Binance)
â”‚   â”œâ”€â”€ trading-service/    # [å®˜æ–¹] æŒ‡æ ‡è®¡ç®— (MACD, RSI...)
â”‚   â”œâ”€â”€ telegram-service/   # [å®˜æ–¹] æœºå™¨äººé€»è¾‘
â”‚   â”œâ”€â”€ stock-service/      # [æ–°å¢] ç¾è‚¡é‡‡é›† (yfinance)
â”‚   â””â”€â”€ api-gateway/        # [è¿ç§»] Obsidian æ’ä»¶æ¥å£
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start.sh            # å®˜æ–¹å¯åŠ¨è„šæœ¬ (Linux/Docker)
â”‚   â””â”€â”€ start_mac.sh        # âœ… Mac ä¸“ç”¨å¯åŠ¨è„šæœ¬ (Python ç›´æ¥è°ƒç”¨)
â””â”€â”€ mn_logs/                # æ‰€æœ‰æœåŠ¡æ—¥å¿—
```

## ğŸš€ è¿ç»´æŒ‡å—

### å¯åŠ¨ç³»ç»Ÿ
```bash
cd backend/tradecat-core
./scripts/start_mac.sh
```

### æŸ¥çœ‹æ—¥å¿—
æ—¥å¿—é›†ä¸­åœ¨ `mn_logs/` ç›®å½•ï¼š
- `data-service.log`: å¸å®‰æ•°æ®é‡‡é›†çŠ¶æ€
- `stock-service.log`: ç¾è‚¡/æœŸè´§é‡‡é›†çŠ¶æ€
- `telegram-service.log`: æœºå™¨äººäº¤äº’æ—¥å¿—
- `api-gateway.log`: Obsidian æ’ä»¶è¯·æ±‚æ—¥å¿—

### æ·»åŠ æ–°ç¾è‚¡ä»£ç 
1. ç¼–è¾‘ `backend/tradecat-core/services/stock-service/src/config.py` (æˆ–è€… `.env` å¦‚æœå°†æ¥æ”¯æŒ)
2. ä¿®æ”¹ `STOCK_SYMBOLS` åˆ—è¡¨ã€‚
3. é‡å¯æœåŠ¡ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹
- **ç¾è‚¡å‡åƒ**: ç¾è‚¡æ•°æ®åœ¨æ•°æ®åº“ä¸­æ¨¡ä»¿äº† Crypto çš„æ ¼å¼ï¼ˆVolume å­˜åœ¨ï¼ŒQuote Volume ä¸º 0ï¼‰ã€‚è¿™æ˜¯ä¸ºäº†è®© `trading-service` èƒ½å¤Ÿè‡ªåŠ¨è®¡ç®— MACD ç­‰æŒ‡æ ‡è€Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚
- **ç«¯å£**:
    - TimescaleDB: 5434
    - API Gateway: 8088
    - Telegram Bot: Polling Mode (æ— ç«¯å£)
