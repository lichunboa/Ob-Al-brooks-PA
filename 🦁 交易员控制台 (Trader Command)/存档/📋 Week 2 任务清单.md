# 📋 Phase 1, Week 2 任务清单

> **时间**: 2026-01-12 ~ 2026-01-16  
> **目标**: 批量操作 + 操作历史 + Schema 扩展  
> **状态**: 准备开始

---

## 📅 Day 6: 批量更新功能 (Part 1)

### 任务 6.1: 扩展类型定义
- [ ] 定义 `BatchActionResult` 接口
- [ ] 定义 `BatchUpdateItem` 接口
- [ ] 更新 `types.ts` 导出

**验证**: TypeScript 编译通过

---

### 任务 6.2: 实现 batchUpdateTrades()
- [ ] 在 `ActionService` 中添加方法
- [ ] 实现分批处理逻辑 (每批50个)
- [ ] 实现并行执行 (`Promise.all()`)
- [ ] 实现错误收集
- [ ] 添加进度日志

**验证**: 
- [ ] 编译通过
- [ ] 方法签名正确

---

## 📅 Day 7: 批量更新功能 (Part 2)

### 任务 7.1: 创建批量更新测试 UI
- [ ] 创建 `BatchUpdateTestPanel.tsx`
- [ ] 添加输入控件
- [ ] 添加测试按钮
- [ ] 显示结果统计

**验证**: UI 正常显示

---

### 任务 7.2: 批量更新测试
- [ ] 创建 10 个测试文件
- [ ] 执行批量更新
- [ ] 验证所有文件都被更新
- [ ] 验证统计信息正确
- [ ] 测试性能 (10个文件 < 1秒)

**验证**: 所有测试通过

---

## 📅 Day 8: 操作历史系统

### 任务 8.1: 设计 ChangeLog 类型
- [ ] 定义 `ChangeLogEntry` 接口
- [ ] 定义 `ChangeLog` 接口
- [ ] 更新 `types.ts`

**验证**: TypeScript 编译通过

---

### 任务 8.2: 实现 ChangeLogManager
- [ ] 创建 `change-log.ts`
- [ ] 实现 `record()` 方法
- [ ] 实现 `getEntries()` 方法
- [ ] 实现 `getEntry()` 方法
- [ ] 实现数量限制 (最多100条)

**验证**: 
- [ ] 编译通过
- [ ] 单元测试通过

---

### 任务 8.3: 集成到 ActionService
- [ ] 在 `ActionService` 中添加 `changeLog` 实例
- [ ] 在 `updateTrade()` 中记录操作
- [ ] 在 `batchUpdateTrades()` 中记录操作
- [ ] 添加 `getChangeLog()` 方法

**验证**: 
- [ ] 操作后可以查看历史
- [ ] 历史记录包含完整信息

---

## 📅 Day 9: 撤销功能

### 任务 9.1: 实现撤销方法
- [ ] 实现 `undo()` 方法
- [ ] 实现 `restoreFile()` 私有方法
- [ ] 处理多文件撤销
- [ ] 错误处理

**验证**: 
- [ ] 编译通过
- [ ] 方法签名正确

---

### 任务 9.2: 撤销功能测试
- [ ] 执行更新操作
- [ ] 记录原始状态
- [ ] 执行撤销
- [ ] 验证文件恢复到原始状态
- [ ] 测试批量撤销

**验证**: 所有测试通过

---

## 📅 Day 10: Schema 扩展

### 任务 10.1: 添加缺失字段
- [ ] 添加 `entryPrice` 字段
- [ ] 添加 `stopLoss` 字段
- [ ] 添加 `takeProfit` 字段
- [ ] 添加 `initialRisk` 字段
- [ ] 添加 `alwaysIn` 字段
- [ ] 添加 `dayType` 字段
- [ ] 添加 `probability` 字段
- [ ] 添加 `confidence` 字段
- [ ] 添加 `orderType` 字段

**验证**: 
- [ ] TypeScript 编译通过
- [ ] 字段总数: 17 → 26

---

### 任务 10.2: Schema 完整性测试
- [ ] 创建包含所有字段的测试文件
- [ ] 测试每个新字段的验证
- [ ] 测试每个新字段的规范化
- [ ] 测试字段别名

**验证**: 所有字段都能正确处理

---

## ✅ Week 2 验收标准

### 功能完整性
- [ ] `batchUpdateTrades()` 实现并测试通过
- [ ] 操作历史记录功能正常
- [ ] 撤销功能正常
- [ ] Schema 扩展到 26 个字段

### 性能指标
- [ ] 批量更新 100 个文件 < 10 秒
- [ ] 单个更新 < 100ms

### 代码质量
- [ ] TypeScript 编译无错误
- [ ] 所有功能都有测试
- [ ] 文档已更新

---

## 📊 进度跟踪

| Day | 任务 | 状态 |
|-----|------|------|
| Day 6 | 类型定义 + batchUpdateTrades | [ ] |
| Day 7 | 批量更新测试 | [ ] |
| Day 8 | ChangeLog 系统 | [ ] |
| Day 9 | 撤销功能 | [ ] |
| Day 10 | Schema 扩展 | [ ] |

**总体进度**: 0/5 天

---

**创建时间**: 2026-01-11  
**下次更新**: Day 6 完成后
