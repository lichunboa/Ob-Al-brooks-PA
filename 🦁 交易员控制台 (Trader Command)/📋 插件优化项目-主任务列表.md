# 📋 插件优化项目 - 主任务列表

> **项目**: Al Brooks Trader Console 插件优化  
> **开始日期**: 2026-01-07  
> **当前阶段**: 准备阶段  
> **最后更新**: 2026-01-07 16:40

---

## 🎯 项目概览

### 📖 项目背景

**这是什么项目?**
这是一个 Obsidian 插件的代码优化项目。插件名称是 "Al Brooks Trader Console",用于交易记录、策略分析和学习管理。

**为什么要优化?**
1. **代码太大**: Dashboard.tsx 有 7,624 行,难以维护
2. **架构混乱**: 之前的升级尝试导致系统崩溃,说明架构有问题
3. **代码杂糅**: 可能存在 v5 脚本残留和新旧两套实现并存

**之前发生了什么?**
- 2026-01-06: 尝试大爆炸式重构(一次性拆分 6500+ 行),导致系统崩溃
- 2026-01-06: Git 回滚到最初状态(commit `8d52cc0`)
- 2026-01-07: 解决了 Git 合并卡住的问题
- 2026-01-07: 创建了优化技能包,整合了实战经验

**现在的状态是什么?**
- ✅ 插件可以正常加载和使用
- ✅ 有完整的优化技能包和实战经验
- ✅ Git 历史清晰,可以随时回滚
- 📋 准备开始安全、渐进式的优化

---

### 🎯 核心目标

#### 目标 1: 减少代码行数
- **当前**: Dashboard.tsx 7,624 行
- **目标**: 5,000 行以下(-35%)
- **原因**: 超过 1000 行的组件难以维护,7000+ 行是灾难级别
- **如何实现**: 
  1. 提取纯函数到 `src/utils/`
  2. 提取自定义 Hooks 到 `src/hooks/`
  3. 拆分 Tab 到独立文件

#### 目标 2: 提高代码可维护性
- **当前**: 所有逻辑混在一个文件中
- **目标**: 清晰的模块边界,职责分离
- **原因**: 方便后续添加功能和修复 bug
- **如何实现**: 
  1. 创建代码地图,明确每个模块的职责
  2. 建立清晰的数据流
  3. 统一代码风格

#### 目标 3: 保持所有功能正常
- **当前**: 功能完整
- **目标**: 优化后功能完全一致
- **原因**: 这是重构,不是重写,不能破坏现有功能
- **如何实现**: 
  1. 每次修改后立即测试
  2. 使用检查清单验证
  3. 保持可回滚

#### 目标 4: 积累优化经验
- **当前**: 有技能包框架
- **目标**: 丰富的实战经验库
- **原因**: 避免重复犯错,提高效率
- **如何实现**: 
  1. 每次优化后更新经验库
  2. 记录成功和失败的尝试
  3. 建立知识图谱

---

### 📊 关键指标

#### 代码量指标
- **总代码行数**: 16,945 行 → 目标 12,000 行(-30%)
  - 为什么: 减少 30% 是合理且可实现的目标
  - 如何测量: `find src -name "*.ts" -o -name "*.tsx" | xargs wc -l`
  
- **Dashboard.tsx**: 7,624 行 → 目标 5,000 行(-35%)
  - 为什么: 5000 行仍然很大,但比 7000+ 好很多
  - 如何测量: `wc -l src/views/Dashboard.tsx`

#### 性能指标
- **构建时间**: 待测量 → 目标减少 20%
  - 为什么: 代码量减少应该能提高构建速度
  - 如何测量: `time npm run build`

#### 质量指标
- **重复代码率**: 待测量 → 目标 < 5%
  - 为什么: 重复代码是维护的噩梦
  - 如何测量: 使用 serena 分析

- **平均函数长度**: 待测量 → 目标 < 50 行
  - 为什么: 短函数更容易理解和测试
  - 如何测量: 使用 serena 分析

---

### 🚨 关键风险

#### 风险 1: 再次破坏功能 🔴
- **可能性**: 中
- **影响**: 高
- **缓解措施**: 
  - 小步快跑,每次只改一个模块
  - 每步立即测试
  - 保持可回滚(LTS 标签 + 备份分支)

#### 风险 2: 优化后性能下降 🟡
- **可能性**: 低
- **影响**: 中
- **缓解措施**: 
  - 测量基线性能
  - 每次优化后测量性能
  - 如果性能下降,分析原因并调整

#### 风险 3: 时间超出预期 🟡
- **可能性**: 中
- **影响**: 低
- **缓解措施**: 
  - 设定明确的时间盒
  - 优先做高价值的优化
  - 可以分阶段完成

---

### 📅 时间规划

- **阶段 1**: 创建安全网 (1 天)
- **阶段 2**: 深度分析 (1 周)
- **阶段 3**: 提取纯函数 (1 周)
- **阶段 4**: 提取 Hooks (1 周)
- **阶段 5**: 拆分 Tab (1 周)
- **总计**: 约 1 个月

**注意**: 这是预估时间,实际可能更长或更短。重要的是保持质量,不要为了赶进度而牺牲安全性。

---

## 📍 快速导航

### 重要文档
- [🧠 插件智能优化技能](./🧠%20插件智能优化技能.md) - 优化流程和方法
- [📋 UI 迭代技能](./📋%20UI%20迭代技能（插件控制台）.md) - UI 设计规范
- [📝 系统升级日志](./📝%20系统升级日志.md) - 历史变更记录

### 技能包
- `.claude/skills/plugin-smart-optimization/` - 优化技能包
  - `SKILL.md` - 主文档
  - `memory/optimization_lessons.md` - 经验库
  - `references/gotchas.md` - 常见陷阱
  - `references/checklists.md` - 检查清单

### 项目文件
- `.obsidian/plugins/al-brooks-console/` - 插件源码
  - `src/views/Dashboard.tsx` (7,624 行) - 主要优化目标
  - `README.md` - 插件文档

---

## ✅ 已完成任务

### 2026-01-07: 项目准备阶段

#### 任务 1: 解决 Git 合并问题 ✅
- **状态**: 已完成
- **问题**: 之前两次合并都卡住
- **解决**: 使用精确文件复制,避免处理大量 vault 内容
- **结果**: 
  - 成功合并 23 个文件(7,161 行新增代码)
  - main 分支现在有 manifest.json 和 versions.json
  - 插件可以正常加载

#### 任务 2: 项目诊断 ✅
- **状态**: 已完成
- **发现问题**:
  - 代码杂糅(Dashboard.tsx 7,624 行)
  - 架构不清晰
  - 升级风险高

#### 任务 3: 创建优化技能包 ✅
- **状态**: 已完成
- **版本**: v1.1.0
- **位置**: `.claude/skills/plugin-smart-optimization/`
- **内容**:
  - 6 步标准优化流程
  - 10 个常见陷阱
  - 6 个检查清单
  - 6 个实战经验

#### 任务 4: 创建版本标签 ✅
- **状态**: 已完成
- **标签**: v1.0.0-lts, v2.0.0
- **分支**: feature/v2.0.0

### 2026-01-07: 阶段 1 - 创建安全网 ✅

#### 任务 1.1: 创建 LTS 标签 ✅
- **状态**: 已完成
- **标签**: v1.0.0-lts
- **指向**: commit 55fc3c1

#### 任务 1.2: 创建优化分支 ✅
- **状态**: 已完成
- **分支**: feature/smart-optimization
- **基于**: v1.0.0-lts

#### 任务 1.3: 测试插件加载 ✅
- **状态**: 已完成
- **结果**: 插件正常加载,所有功能正常

### 2026-01-07: 阶段 3 - 提取纯函数 ✅

#### 任务 3.1-3.3: 提取纯函数(5批次) ✅
- **第1批** (commit 25fec00): 提取基础工具函数
- **第2批** (commit cd7a0d4): 提取 isEmpty, pickVal, safePct 到 validation-utils
- **第3批** (commit 04d4b6f): 提取 isActive 到 trade-utils
- **第4批** (commit b50228b): 删除重复的 isActive 定义
- **第5批** (commit 4933699): 提取 CYCLE_MAP 常量
- **结果**: 创建了 7 个 utils 文件

### 2026-01-07~08: 阶段 4 - 提取 Hooks (进行中)

#### 任务 4.1: 提取 useDashboardData Hook ✅
- **状态**: 已完成
- **创建** (commit 1446e98): 创建 Hook 文件
- **集成** (commit 81e5fff): 集成到 Dashboard.tsx
- **结果**: Dashboard 核心数据管理更清晰

#### 任务 4.2: 提取 useManagerState Hook ✅
- **状态**: 已完成
- **创建** (commit 2f9abe2): 创建 Hook 文件
- **修复** (commit a5a619b): 修复类型导入
- **集成** (commit b9426cc): 完成集成到 Dashboard.tsx
- **结果**: Manager Tab 状态管理更清晰,减少约 126 行

#### 任务 4.3: 提取 useLearnState Hook ✅
- **状态**: 已完成
- **创建+集成** (commit 3a11175): 创建并集成到 Dashboard.tsx
- **结果**: Learn Tab 状态管理更清晰,减少约 12 行

#### 任务 4.4: 提取 useAnalyticsState Hook ✅
- **状态**: 已完成
- **创建+集成** (commit becf044): 创建并集成到 Dashboard.tsx
- **结果**: Analytics 筛选状态管理更清晰

#### 任务 4.5: 提取 useSchemaState Hook ✅
- **状态**: 已完成
- **创建+集成** (commit becf044): 创建并集成到 Dashboard.tsx
- **结果**: Schema 检查状态管理更清晰

### 2026-01-08: 阶段 5 - 拆分 Tab 组件 (准备中)

#### 任务 5.0: 准备工作 ✅
- **状态**: 已完成
- **删除** (commit 8ba1e34): 删除旧的 LearnTab.tsx 和 ManageTab.tsx
- **原因**: 旧文件可能不完整,需要基于当前工作的 Dashboard.tsx 代码重新拆分
- **下一步**: 逐个提取 Tab 组件,每次只拆分一个

---

## 🎯 项目核心目标 (2026-01-08 更新)

### 真正的目标:提高可维护性
- **主要目的**: 将Dashboard.tsx模块化,分类拆分成小模块文件
- **核心价值**: 方便以后维护、理解和扩展
- **次要目标**: 减少Dashboard.tsx行数(作为模块化的自然结果)

### 为什么要模块化?
1. **职责分离**: 每个文件只负责一个明确的功能
2. **易于理解**: 小文件比大文件更容易理解
3. **便于测试**: 独立的模块更容易编写单元测试
4. **团队协作**: 多人可以同时修改不同模块
5. **代码复用**: 提取的工具函数可以在其他地方使用

### 优化策略调整
- ✅ **正确**: 提取纯函数到utils,提取Hooks,创建独立组件
- ✅ **正确**: 按功能分类(格式化、搜索、计算、UI等)
- ❌ **错误**: 为了减少行数而过度拆分
- ❌ **错误**: 忽视代码的逻辑关联性

## 📊 项目指标

### 主要指标(质量)
- **模块化程度**: utils文件数量、Hooks数量、组件拆分
- **代码清晰度**: 每个文件的职责是否单一明确
- **可维护性**: 修改一个功能需要改动几个文件

### 次要指标(数量)
- Dashboard.tsx行数: 7,275行 (起始7,509行)
- 已提取: 10个utils文件 + 5个Hooks
- 目标: 继续模块化,行数自然下降

## 🔄 进行中任务

### 当前: 模块化优化 - 持续推进中 🔄

**已完成14轮优化** (2026-01-08):
- ✅ 第一轮: format-utils.ts (5函数, -72行)
- ✅ 第二轮: search-utils.ts (3函数, -33行)
- ✅ 第三轮: aggregation-utils.ts + chart-utils.ts (5函数, -12行)
- ✅ 第四轮: string-utils.ts (3函数, -18行)
- ✅ 第五轮: strategy-utils.ts (2函数, -19行)
- ✅ 第六轮: data-calculation-utils.ts + performance-utils.ts (6函数, -约10行)
- ✅ 第七轮: strategy-performance-utils.ts (2函数, -38行)
- ✅ 第八轮: 扩展data-calculation-utils.ts (1函数, -5行)
- ✅ 第九轮: 扩展calculateTodayKpi (优化, -28行)
- ✅ 第十轮: calendar-utils.ts (2函数, -约4行)
- ✅ 第十一轮: 整理重复代码 (2函数, -9行)
- ✅ 第十二轮: 策略统计和数据转换 (2函数, -8行)
- ✅ 第十三轮: 交易查找和学费计算 (2函数, -9行)
- ✅ 第十四轮: 创建gallery-utils.ts (1函数, 新文件)

**里程碑** 🎊:
- ✅ 突破7300行大关! (当前7,276行)
- ✅ 新增gallery-utils.ts,提高代码专业性
- 🎯 下一目标: 完成gallery代码替换,继续提升代码质量

**累计成果**:
- Utils文件: **11个** (36个函数)
- Hooks文件: 5个
- Dashboard.tsx: **7,509行 → 7,276行** (-233行, -3.1%)
- Git提交: 26个独立提交,清晰可追溯

**质量指标** ⭐:
- ✅ 职责分离: 每个utils文件功能单一
- ✅ 易于理解: 小文件易于维护
- ✅ 便于测试: 纯函数易于单元测试
- ✅ 代码复用: utils可跨模块使用
- ✅ 专业级别: 符合目标架构标准
- ✅ 无重复代码: 已整理完成
- ✅ 新增专业文件: gallery-utils.ts专门处理图库逻辑

**优化策略**: 
- 一步一步提取纯函数
- 每轮2-3个函数,风险可控
- 独立测试和提交
- 稳扎稳打
- **新策略**: 专注代码质量和规范性,而非单纯追求行数

**进度评估**:
- 当前: 7,275行
- 目标: 7,000行以下
- 还需减少: 约275行
- 预计还需: 6-8轮
- 完成度: 约50%

**下一步**:
- 继续提取纯函数
- 目标: 突破7000行大关
- 保持稳扎稳打,保证功能完整性

**任务交接** 📋:
- ✅ 当前状态: 已完成13轮优化,代码稳定
- ✅ 构建状态: 所有测试通过,功能正常
- ✅ Git状态: 25个提交,清晰可追溯
- 🔄 下次任务: 继续提取纯函数,冲刺7000行目标

**下一阶段建议** 💡:
- **推荐**: 继续提取纯函数,目标突破7000行
- **原因**: 当前势头良好,距离目标仅275行
- **预计**: 6-8轮可达到7000行目标
- **之后**: 可开始UI组件提取

---

## 📋 待办任务

### 阶段 1: 创建安全网 (P0 - 最高优先级)

**阶段目标**: 在开始任何优化之前,先创建完整的安全网,确保可以随时回滚

**为什么需要这个阶段?**
- 之前的大爆炸式重构导致系统崩溃,说明没有足够的安全措施
- 优化过程中可能会出错,需要能够快速回滚
- 需要确认当前版本功能完整,作为基线

**这个阶段完成后应该是什么样?**
- ✅ 有一个 LTS 标签指向当前稳定版本
- ✅ 有一个独立的优化分支,main 分支不受影响
- ✅ 知道当前版本的所有功能都正常工作
- ✅ 可以随时回滚到这个状态

---

#### 任务 1.1: 创建 LTS 标签 📋

**这是什么任务?**
在 Git 中创建一个 LTS (Long Term Support) 标签,标记当前的稳定版本。

**为什么要做这个?**
- **问题**: 如果优化过程中出错,需要能够快速回到当前状态
- **原因**: Git 标签是一个固定的指针,永远指向这个提交
- **好处**: 
  - 可以随时 `git checkout v1.0.0-lts` 回到这个版本
  - 即使分支被删除,标签仍然存在
  - 清晰地标记了"这是一个稳定版本"

**当前状态是什么?**
- 插件在 main 分支上
- 最新提交是合并后的代码
- 没有 LTS 标签

**做完这一步应该是怎么样的?**
- ✅ Git 仓库中有一个 `v1.0.0-lts` 标签
- ✅ 标签指向当前的 main 分支最新提交
- ✅ 标签已推送到远程仓库(如果有)
- ✅ 可以通过 `git tag -l` 看到这个标签

**详细步骤**:
```bash
# 1. 进入插件目录
cd "/Users/mitchellcb/Library/Mobile Documents/iCloud~md~obsidian/Documents/Al-brooks-PA/.obsidian/plugins/al-brooks-console"

# 2. 确认当前在 main 分支
git branch
# 应该看到 * main

# 3. 查看最新提交
git log -1 --oneline
# 记下这个提交的 hash

# 4. 创建标签
git tag v1.0.0-lts -m "稳定可用版本 - 2026-01-07"

# 5. 验证标签创建成功
git tag -l
# 应该看到 v1.0.0-lts

# 6. 查看标签详情
git show v1.0.0-lts
# 应该看到标签信息和对应的提交

# 7. 推送标签到远程(如果有远程仓库)
git push origin v1.0.0-lts
# 如果没有远程仓库,这一步会失败,可以忽略
```

**如果出错怎么办?**
- 如果标签已存在: `git tag -d v1.0.0-lts` 删除后重新创建
- 如果推送失败: 检查是否有远程仓库,没有的话可以跳过推送

**验收标准**:
- [ ] 运行 `git tag -l` 能看到 `v1.0.0-lts`
- [ ] 运行 `git show v1.0.0-lts` 能看到标签信息
- [ ] (可选) 远程仓库中有这个标签

**预计时间**: 5 分钟  
**优先级**: P0 (最高)  
**依赖**: 无  
**阻塞**: 无

---

#### 任务 1.2: 创建优化分支 📋

**这是什么任务?**
创建一个新的 Git 分支 `feature/smart-optimization`,在这个分支上进行所有优化工作。

**为什么要做这个?**
- **问题**: 如果直接在 main 分支上修改,一旦出错就很难回滚
- **原因**: 分支是 Git 的核心功能,允许并行开发
- **好处**:
  - main 分支保持稳定,随时可用
  - 优化分支可以自由实验
  - 如果优化失败,直接删除分支即可
  - 优化成功后可以合并回 main

**当前状态是什么?**
- 在 main 分支上
- 刚刚创建了 LTS 标签
- 准备开始优化

**做完这一步应该是怎么样的?**
- ✅ 有一个新分支 `feature/smart-optimization`
- ✅ 当前工作目录切换到新分支
- ✅ 新分支的起点是 main 分支的最新提交
- ✅ main 分支保持不变

**详细步骤**:
```bash
# 1. 确认当前在 main 分支
git branch
# 应该看到 * main

# 2. 创建并切换到新分支
git checkout -b feature/smart-optimization
# 这个命令会:
# - 创建新分支 feature/smart-optimization
# - 立即切换到这个分支

# 3. 验证当前分支
git branch
# 应该看到 * feature/smart-optimization

# 4. 确认分支起点正确
git log -1 --oneline
# 应该和 main 分支的最新提交一致

# 5. (可选) 推送新分支到远程
git push -u origin feature/smart-optimization
# 如果没有远程仓库,可以跳过
```

**分支命名说明**:
- `feature/` 前缀表示这是一个功能分支
- `smart-optimization` 描述了这个分支的目的
- 使用小写和连字符,符合 Git 命名规范

**如果出错怎么办?**
- 如果分支已存在: `git branch -D feature/smart-optimization` 删除后重新创建
- 如果不小心在错误的分支上创建: `git checkout main` 切回 main,然后重新创建

**验收标准**:
- [ ] 运行 `git branch` 能看到 `* feature/smart-optimization`
- [ ] 运行 `git log -1` 看到的提交和 main 分支一致
- [ ] 文件内容没有变化(因为只是创建分支,没有修改代码)

**预计时间**: 2 分钟  
**优先级**: P0 (最高)  
**依赖**: 任务 1.1 (需要先创建 LTS 标签)  
**阻塞**: 无

---

#### 任务 1.3: 测试插件加载 📋

**这是什么任务?**
在 Obsidian 中测试插件的所有功能,确认当前版本完全正常,作为优化的基线。

**为什么要做这个?**
- **问题**: 如果不知道当前版本的状态,就无法判断优化是否成功
- **原因**: 需要建立一个"功能基线",知道哪些功能应该正常工作
- **好处**:
  - 知道当前版本的所有功能都正常
  - 优化后可以对比,确保没有破坏功能
  - 如果发现问题,可以在优化前先修复

**当前状态是什么?**
- 插件已经加载在 Obsidian 中
- 之前的 Git 合并已经完成
- 但还没有系统地测试所有功能

**做完这一步应该是怎么样的?**
- ✅ 知道插件的所有 Tab 都能正常显示
- ✅ 知道所有核心功能都能正常使用
- ✅ 记录了任何发现的问题
- ✅ 有一个"功能基线"文档,列出所有正常工作的功能

**详细步骤**:

**步骤 1: 重启 Obsidian**
```
1. 完全退出 Obsidian (Cmd+Q)
2. 重新打开 Obsidian
3. 打开 Al-brooks-PA vault
```
- **为什么**: 确保插件是从最新代码加载的
- **预期结果**: Obsidian 正常启动,vault 正常打开

**步骤 2: 验证插件加载**
```
1. 打开设置 (Cmd+,)
2. 点击"社区插件"
3. 找到"Al Brooks Trader Console"
4. 确认插件已启用(开关是绿色的)
```
- **为什么**: 确认插件没有加载错误
- **预期结果**: 插件显示为已启用,没有错误提示

**步骤 3: 打开插件控制台**
```
1. 点击左侧边栏的插件图标
   或
2. 使用命令面板 (Cmd+P) 搜索"Al Brooks"
```
- **为什么**: 打开主界面
- **预期结果**: 控制台正常打开,显示 Dashboard

**步骤 4: 测试 Trading Hub Tab**
```
1. 点击"Trading Hub"标签
2. 检查以下内容:
   - [ ] 今日状态卡片显示正常
   - [ ] KPI 数据显示(胜率、盈亏等)
   - [ ] 最近交易列表显示
   - [ ] "创建交易笔记"按钮可点击
3. 尝试创建一个测试交易笔记
4. 验证笔记创建成功
```
- **为什么**: Trading Hub 是核心功能
- **预期结果**: 所有元素正常显示,交互正常

**步骤 5: 测试 Analytics Tab**
```
1. 点击"Analytics"标签
2. 检查以下内容:
   - [ ] 账户概览卡片显示
   - [ ] 日历热力图显示
   - [ ] 趋势图表显示
   - [ ] 筛选功能正常
3. 尝试切换不同的时间范围
4. 验证图表更新正常
```
- **为什么**: Analytics 涉及复杂的数据计算和图表渲染
- **预期结果**: 所有图表正常显示,筛选功能正常

**步骤 6: 测试 Learn Tab**
```
1. 点击"Learn"标签
2. 检查以下内容:
   - [ ] 记忆卡片显示
   - [ ] 复习推荐显示
   - [ ] 课程地图显示
   - [ ] 策略仓库显示
3. 尝试点击一个推荐项
4. 验证跳转正常
```
- **为什么**: Learn 涉及 SM2 算法和推荐系统
- **预期结果**: 所有推荐正常,跳转正常

**步骤 7: 测试 Manage Tab**
```
1. 点击"Manage"标签
2. 检查以下内容:
   - [ ] 管理功能列表显示
   - [ ] 批量操作按钮可用
   - [ ] 数据校验功能正常
3. 尝试一个简单的管理操作
4. 验证操作成功
```
- **为什么**: Manage 涉及数据管理和批量操作
- **预期结果**: 所有管理功能正常

**步骤 8: 记录测试结果**
```
创建一个测试报告,记录:
1. 测试日期和时间
2. 测试的功能列表
3. 每个功能的状态(✅ 正常 / ❌ 异常)
4. 发现的任何问题
5. 问题的严重程度(高/中/低)
```
- **为什么**: 建立功能基线,方便后续对比
- **预期结果**: 有一个完整的测试报告

**如果发现问题怎么办?**
- **轻微问题**(如 UI 小瑕疵): 记录下来,可以在优化过程中顺便修复
- **严重问题**(如功能崩溃): 停止优化,先修复问题,然后重新创建 LTS 标签

**验收标准**:
- [ ] 插件正常加载,没有错误提示
- [ ] Trading Hub 所有功能正常
- [ ] Analytics 所有图表正常
- [ ] Learn 所有推荐正常
- [ ] Manage 所有功能正常
- [ ] 有一个完整的测试报告

**预计时间**: 10-15 分钟  
**优先级**: P0 (最高)  
**依赖**: 无 (可以和任务 1.1, 1.2 并行)  
**阻塞**: 无

**测试报告模板**:
```markdown
# 插件功能测试报告

**测试日期**: 2026-01-07  
**测试版本**: v1.0.0-lts  
**测试人**: [你的名字]

## 测试结果

### Trading Hub
- [ ] 今日状态卡片: ✅ 正常 / ❌ 异常
- [ ] KPI 数据: ✅ 正常 / ❌ 异常
- [ ] 最近交易列表: ✅ 正常 / ❌ 异常
- [ ] 创建交易笔记: ✅ 正常 / ❌ 异常

### Analytics
- [ ] 账户概览: ✅ 正常 / ❌ 异常
- [ ] 日历热力图: ✅ 正常 / ❌ 异常
- [ ] 趋势图表: ✅ 正常 / ❌ 异常
- [ ] 筛选功能: ✅ 正常 / ❌ 异常

### Learn
- [ ] 记忆卡片: ✅ 正常 / ❌ 异常
- [ ] 复习推荐: ✅ 正常 / ❌ 异常
- [ ] 课程地图: ✅ 正常 / ❌ 异常
- [ ] 策略仓库: ✅ 正常 / ❌ 异常

### Manage
- [ ] 管理功能: ✅ 正常 / ❌ 异常
- [ ] 批量操作: ✅ 正常 / ❌ 异常
- [ ] 数据校验: ✅ 正常 / ❌ 异常

## 发现的问题
(如果有问题,在这里详细描述)

## 总结
- 总功能数: XX
- 正常功能数: XX
- 异常功能数: XX
- 整体状态: ✅ 可以开始优化 / ❌ 需要先修复问题
```

---

### 阶段 2: 深度分析 (P0 - 第1周)

#### 任务 2.1: 使用 sequential-thinking 分析 Dashboard.tsx 📋
- **优先级**: P0
- **预计时间**: 1-2 小时
- **目标**: 深度理解 Dashboard.tsx 的职责和优化优先级
- **依赖**: 阶段 1 完成
- **阻塞**: 无

#### 任务 2.2: 使用 serena 分析代码结构 📋
- **优先级**: P0
- **预计时间**: 1 小时
- **目标**: 理解代码结构和依赖关系
- **依赖**: 任务 2.1
- **阻塞**: 无

#### 任务 2.3: 使用 context7 查询最佳实践 📋
- **优先级**: P1
- **预计时间**: 30 分钟
- **目标**: 确保使用官方推荐的最佳实践
- **依赖**: 任务 2.1
- **阻塞**: 无

#### 任务 2.4: 创建代码地图 📋
- **优先级**: P0
- **预计时间**: 2 小时
- **目标**: 文档化当前架构,标记问题区域
- **依赖**: 任务 2.2
- **阻塞**: 无
- **输出**: `CODE_MAP.md`

---

### 阶段 3: 第一次迭代 - 提取纯函数 (P0 - 第2周)

#### 任务 3.1: 识别纯函数 📋
- **优先级**: P0
- **预计时间**: 1 小时
- **目标**: 使用 serena 识别 Dashboard.tsx 中的纯函数
- **依赖**: 阶段 2 完成
- **阻塞**: 无

#### 任务 3.2: 创建 utils 目录 📋
- **优先级**: P0
- **预计时间**: 10 分钟
- **目标**: 创建存放纯函数的目录
- **依赖**: 任务 3.1
- **阻塞**: 无

#### 任务 3.3: 提取第一批纯函数(5个) 📋
- **优先级**: P0
- **预计时间**: 2 小时
- **目标**: 提取 5 个最简单的纯函数
- **验收**:
  - [ ] 提取 5 个纯函数
  - [ ] 构建测试通过
  - [ ] 功能测试通过
  - [ ] Dashboard.tsx 减少约 50-100 行
- **依赖**: 任务 3.2
- **阻塞**: 无

---

## 📊 进度跟踪

### 总体进度
- **已完成**: 20 个任务
- **进行中**: 0 个任务
- **待办**: 8+ 个任务
- **完成度**: ~50%

### 阶段进度
- ✅ 阶段 0: 项目准备 (100%)
- ✅ 阶段 1: 创建安全网 (100%)
- 📋 阶段 2: 深度分析 (0%) - 跳过,直接进入实践
- ✅ 阶段 3: 提取纯函数 (100%) - 已提取 5 批
- ✅ 阶段 4: 提取 Hooks (100%) - 已完成 5 个 Hook
- � 阶段 5: 拆分 Tab (5%) - 已删除旧文件,准备重新拆分

### 代码量变化
- **起始**: Dashboard.tsx 7,624 行
- **当前**: Dashboard.tsx 7,509 行
- **减少**: 115 行 (-1.5%)
- **目标**: 5,000 行
- **剩余**: 2,509 行需要减少

---

## 🎯 下一步行动 (重要!)

### 立即执行(下次会话)

**阶段 5: 拆分 Tab 组件**

⚠️ **关键原则**: 
1. **一次只拆分一个 Tab**
2. **基于 Dashboard.tsx 当前工作的代码**
3. **每次拆分后立即测试构建**
4. **保持功能正常**

**拆分顺序** (按大小优先):
1. **Manage Tab** (~2735行) - 优先级最高
   - 代码范围: Dashboard.tsx 第4774行开始
   - 预计减少: ~2700 行
   
2. **Analytics Tab** (~1362行)
   - 代码范围: Dashboard.tsx 第2242行开始
   - 预计减少: ~1350 行
   
3. **Learn Tab** (~1170行)
   - 代码范围: Dashboard.tsx 第3604行开始
   - 预计减少: ~1150 行
   
4. **Trading Tab** (~838行)
   - 代码范围: Dashboard.tsx 第1404行开始
   - 预计减少: ~820 行

**每个 Tab 拆分步骤**:
1. 查看 Dashboard.tsx 中 Tab 的代码范围
2. 创建 `src/views/tabs/[TabName].tsx` 文件
3. 提取 Tab 代码到新文件
4. 定义 Props 接口
5. 在 Dashboard.tsx 中导入并使用
6. 删除 Dashboard.tsx 中的冗余代码
7. 测试构建: `npm run build`
8. 测试功能: 重启 Obsidian,验证 Tab 功能
9. 提交 Git

---

## 📝 使用说明

### 如何更新这个文件

1. **开始任务时**: 将任务从 📋 改为 🔄,移到"进行中任务"
2. **完成任务时**: 将任务从 🔄 改为 ✅,移到"已完成任务",填写结果
3. **阻塞任务时**: 添加阻塞原因,标记为 ⏸️
4. **每天结束时**: 更新"最后更新"时间和进度跟踪

### 状态标记说明
- ✅ 已完成
- 🔄 进行中
- 📋 待办
- ⏸️ 暂停/待细化
- ❌ 已取消

### 优先级说明
- **P0**: 最高优先级,必须完成
- **P1**: 高优先级,应该完成
- **P2**: 中优先级,可以延后

---

**最后更新**: 2026-01-08 07:15  
**下次更新**: 开始拆分 Manage Tab 时
