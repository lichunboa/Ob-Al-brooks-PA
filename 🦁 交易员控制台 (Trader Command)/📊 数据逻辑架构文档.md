# ğŸ“Š æ’ä»¶æ§åˆ¶å°æ•°æ®é€»è¾‘æ¶æ„æ–‡æ¡£

> **æ–‡æ¡£ç±»å‹**: æ ¸å¿ƒæŠ€æœ¯æ–‡æ¡£  
> **ç‰ˆæœ¬**: v1.0.0  
> **åˆ›å»º**: 2026-01-11  
> **ç»´æŠ¤**: æŒç»­æ›´æ–°  
> **é‡è¦æ€§**: â­â­â­â­â­ æ ¸å¿ƒæ¶æ„æ–‡æ¡£

---

## ğŸ“– æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†Al Brooks Trader Consoleæ’ä»¶çš„**å®Œæ•´æ•°æ®é€»è¾‘æ¶æ„**ï¼ŒåŒ…æ‹¬ï¼š
- æ•°æ®æºä¸æ•°æ®é‡‡é›†
- æ•°æ®ç´¢å¼•ä¸å­˜å‚¨
- æ•°æ®å¤„ç†ä¸è®¡ç®—
- æ•°æ®å±•ç¤ºä¸äº¤äº’

**ä¸ºä»€ä¹ˆé‡è¦**:
- ğŸ¯ ç†è§£ç³»ç»Ÿå¦‚ä½•å·¥ä½œçš„æ ¸å¿ƒ
- ğŸ”§ å¼€å‘æ–°åŠŸèƒ½çš„å¿…è¯»æ–‡æ¡£
- ğŸ› è°ƒè¯•é—®é¢˜çš„å…³é”®å‚è€ƒ
- ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€çŸ¥è¯†

---

## ğŸ—ï¸ ä¸€ã€ç³»ç»Ÿæ¶æ„æ€»è§ˆ

### 1.1 æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Obsidian Vault (æ•°æ®æº)                     â”‚
â”‚  - äº¤æ˜“ç¬”è®° (Markdown + Frontmatter)                     â”‚
â”‚  - ç­–ç•¥å¡ç‰‡ (Markdown + Frontmatter)                     â”‚
â”‚  - æ—¥è®°ç¬”è®° (Markdown + Frontmatter)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç´¢å¼•å±‚ (Indexer Layer)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TradeIndex   â”‚  â”‚ StrategyIndexâ”‚  â”‚ TodayContext â”‚  â”‚
â”‚  â”‚ (äº¤æ˜“ç´¢å¼•)   â”‚  â”‚ (ç­–ç•¥ç´¢å¼•)   â”‚  â”‚ (ä»Šæ—¥ä¸Šä¸‹æ–‡) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  - å®æ—¶ç›‘å¬æ–‡ä»¶å˜åŒ–                                      â”‚
â”‚  - è§£æFrontmatter                                      â”‚
â”‚  - è§„èŒƒåŒ–æ•°æ®                                            â”‚
â”‚  - å†…å­˜ç¼“å­˜                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ ¸å¿ƒä¸šåŠ¡å±‚ (Core Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Analytics    â”‚  â”‚ Stats        â”‚  â”‚ Coach        â”‚  â”‚
â”‚  â”‚ (æ•°æ®åˆ†æ)   â”‚  â”‚ (ç»Ÿè®¡è®¡ç®—)   â”‚  â”‚ (æ•™ç»ƒå»ºè®®)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  - ç­–ç•¥å½’å›                                               â”‚
â”‚  - ä¸Šä¸‹æ–‡åˆ†æ                                            â”‚
â”‚  - å­¦è´¹ç»Ÿè®¡                                              â”‚
â”‚  - æƒç›Šæ›²çº¿                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è§†å›¾å±‚ (View Layer)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ TradingHub   â”‚  â”‚ Analytics    â”‚  â”‚ Learn        â”‚  â”‚
â”‚  â”‚ (äº¤æ˜“ä¸­å¿ƒ)   â”‚  â”‚ (æ•°æ®åˆ†æ)   â”‚  â”‚ (å­¦ä¹ æ¨¡å—)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  - Reactç»„ä»¶                                             â”‚
â”‚  - æ•°æ®è®¢é˜…                                              â”‚
â”‚  - ç”¨æˆ·äº¤äº’                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™

**ç¡®å®šæ€§é€»è¾‘ (Deterministic Logic)**:
- âœ… ä¸¥æ ¼åŸºäºå›ºå®šSchema (PA_Metadata_Schema)
- âœ… æ‰€æœ‰å­—æ®µéƒ½æœ‰æ˜ç¡®çš„åˆ«åæ˜ å°„
- âœ… æ•°æ®è§„èŒƒåŒ–åœ¨ç´¢å¼•å±‚å®Œæˆ
- âŒ æ‹’ç»æ¨¡ç³ŠçŒœæµ‹å’Œå‡è®¾

**å•ä¸€æ•°æ®æº (Single Source of Truth)**:
- ğŸ“ Obsidian Vaultæ˜¯å”¯ä¸€æ•°æ®æº
- ğŸ”„ ç´¢å¼•å±‚å®æ—¶åŒæ­¥Vaultå˜åŒ–
- ğŸ’¾ å†…å­˜ç¼“å­˜æé«˜æ€§èƒ½
- ğŸš« ä¸ä¾èµ–å¤–éƒ¨æ•°æ®åº“

**æ¾è€¦åˆæ¶æ„ (Loose Coupling)**:
- ğŸ”Œ ç´¢å¼•å±‚ä¸ä¸šåŠ¡å±‚è§£è€¦
- ğŸ¨ ä¸šåŠ¡å±‚ä¸è§†å›¾å±‚è§£è€¦
- ğŸ”§ æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

---

## ğŸ“‚ äºŒã€æ•°æ®æºå±‚ (Data Source)

### 2.1 äº¤æ˜“ç¬”è®° (Trade Notes)

**è¯†åˆ«æ ‡å‡†**:
1. **Frontmatteræ ‡ç­¾**: `tags: ["PA/Trade"]`
2. **FileClass**: `fileClass: PA_Metadata_Schema`

**æ ¸å¿ƒå­—æ®µ** (é€šè¿‡FIELD_ALIASESæ˜ å°„):

| å­—æ®µå | åˆ«å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|------|
| `date` | æ—¥æœŸ/date | string/Date | âœ… | äº¤æ˜“æ—¥æœŸ (YYYY-MM-DD) |
| `pnl` | ç›ˆäº/net_profit/r | number | âœ… | ç›ˆäº (Rå€¼) |
| `ticker` | æ ‡çš„/ticker | string | âœ… | äº¤æ˜“æ ‡çš„ |
| `outcome` | ç»“æœ/outcome | enum | âœ… | win/loss/scratch/open |
| `accountType` | è´¦æˆ·ç±»å‹/account_type | enum | âœ… | Live/Demo/Backtest |
| `marketCycle` | å¸‚åœºå‘¨æœŸ/market_cycle | string | âšª | å¼ºè¶‹åŠ¿/å¼±è¶‹åŠ¿/äº¤æ˜“åŒºé—´ |
| `setupKey` | è®¾ç½®/setup_key | string | âšª | è®¾ç½®å…³é”®å­— |
| `setupCategory` | è®¾ç½®åˆ†ç±»/setup_category | string | âšª | è®¾ç½®åˆ†ç±» |
| `patternsObserved` | å½¢æ€/patterns_observed | string[] | âšª | è§‚å¯Ÿåˆ°çš„å½¢æ€ |
| `signalBarQuality` | ä¿¡å·è´¨é‡/signal_bar_quality | string[] | âšª | ä¿¡å·æŸ±è´¨é‡ |
| `timeframe` | æ—¶é—´æ¡†æ¶/timeframe | string | âšª | æ—¶é—´æ¡†æ¶ |
| `direction` | æ–¹å‘/direction | string | âšª | Long/Short |
| `strategyName` | ç­–ç•¥åç§°/strategy_name | string | âšª | ç­–ç•¥åç§° |
| `managementPlan` | ç®¡ç†è®¡åˆ’/management_plan | string[] | âšª | ç®¡ç†è®¡åˆ’ |
| `executionQuality` | æ‰§è¡Œè¯„ä»·/execution_quality | string | âšª | Perfect/Valid/é”™è¯¯ç±»å‹ |
| `cover` | å°é¢/cover | string | âšª | å°é¢å›¾ç‰‡è·¯å¾„ |

**æ•°æ®è§„èŒƒåŒ–è§„åˆ™**:
1. **æ—¥æœŸè§„èŒƒåŒ–**:
   - ä¼˜å…ˆçº§: Frontmatter `date` â†’ æ–‡ä»¶åæ—¥æœŸ â†’ æ–‡ä»¶åˆ›å»ºæ—¶é—´
   - æ ¼å¼: YYYY-MM-DD (ISO 8601)
   - æ–‡ä»¶åæ”¯æŒ: `YYYY-MM-DD`, `YYYYMMDD`, `YYMMDD`

2. **ç›ˆäºè§„èŒƒåŒ–**:
   - ä¼˜å…ˆçº§: `pnl` â†’ `net_profit` â†’ `r`
   - ç±»å‹: number (Rå€¼)
   - v5å¯¹é½: æ—§æ•°æ®å¯èƒ½åªå¡«rï¼Œè‡ªåŠ¨å…œåº•

3. **ç»“æœè§„èŒƒåŒ–**:
   - æšä¸¾å€¼: `win`, `loss`, `scratch`, `open`, `unknown`
   - å¤§å°å†™ä¸æ•æ„Ÿ

4. **è´¦æˆ·ç±»å‹è§„èŒƒåŒ–**:
   - æšä¸¾å€¼: `Live`, `Demo`, `Backtest`
   - æ˜ å°„: å®ç›˜â†’Live, æ¨¡æ‹Ÿâ†’Demo, å›æµ‹â†’Backtest

### 2.2 ç­–ç•¥å¡ç‰‡ (Strategy Cards)

**è¯†åˆ«æ ‡å‡†**:
- è·¯å¾„: `ç­–ç•¥ä»“åº“ (Strategy Repository)/`
- æ ‡ç­¾: `tags: ["PA/Strategy"]`

**æ ¸å¿ƒå­—æ®µ**:
- `canonicalName`: è§„èŒƒåç§°
- `patterns`: å…³è”å½¢æ€åˆ—è¡¨
- `setupCategory`: è®¾ç½®åˆ†ç±»
- `description`: ç­–ç•¥æè¿°

### 2.3 ä»Šæ—¥ä¸Šä¸‹æ–‡ (Today Context)

**è¯†åˆ«æ ‡å‡†**:
- è·¯å¾„: `Daily/` æ–‡ä»¶å¤¹
- æ–‡ä»¶å: åŒ…å«ä»Šæ—¥æ—¥æœŸ

**æ ¸å¿ƒå­—æ®µ**:
- `marketCycle`: ä»Šæ—¥å¸‚åœºå‘¨æœŸ
- `dailyPlan`: ä»Šæ—¥è®¡åˆ’

---

## ğŸ—‚ï¸ ä¸‰ã€ç´¢å¼•å±‚ (Indexer Layer)

### 3.1 ObsidianTradeIndex (äº¤æ˜“ç´¢å¼•)

**èŒè´£**: 
- æ‰«æVaultä¸­çš„æ‰€æœ‰äº¤æ˜“ç¬”è®°
- è§£æFrontmatterå¹¶è§„èŒƒåŒ–æ•°æ®
- å®æ—¶ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶æ›´æ–°ç´¢å¼•
- æä¾›æŸ¥è¯¢æ¥å£

**æ ¸å¿ƒAPI**:

```typescript
class ObsidianTradeIndex {
  // åˆå§‹åŒ–ç´¢å¼•
  async initialize(): Promise<void>
  
  // è·å–æ‰€æœ‰äº¤æ˜“è®°å½• (æŒ‰æ—¥æœŸé™åº)
  getAll(): TradeRecord[]
  
  // ç›‘å¬ç´¢å¼•å˜åŒ–
  onChanged(handler: () => void): () => void
  
  // è·å–ç´¢å¼•çŠ¶æ€
  getStatus(): TradeIndexStatus
  
  // é‡å»ºç´¢å¼•
  async rebuild(): Promise<void>
}
```

**æ€§èƒ½ä¼˜åŒ–**:
1. **åˆ†å—å¤„ç†** (Chunking):
   - é»˜è®¤æ¯250ä¸ªæ–‡ä»¶ä¸ºä¸€æ‰¹
   - æ¯æ‰¹ä¹‹é—´yieldæ§åˆ¶æƒï¼Œé¿å…é˜»å¡UI
   
2. **é˜²æŠ–æœºåˆ¶** (Debouncing):
   - æ–‡ä»¶å˜æ›´äº‹ä»¶200msé˜²æŠ–
   - é¿å…é¢‘ç¹é‡å»ºç´¢å¼•

3. **æœ€å°å‘å°„é—´éš”** (Min Emit Interval):
   - ç´¢å¼•å˜æ›´é€šçŸ¥æœ€å°é—´éš”200ms
   - å‡å°‘Reactç»„ä»¶é‡æ¸²æŸ“

4. **æ–‡ä»¶å¤¹è¿‡æ»¤**:
   - é»˜è®¤æ’é™¤: `Templates/`, `Exports/`, `.obsidian/`
   - å‡å°‘æ‰«æèŒƒå›´

**æ•°æ®ç»“æ„**:

```typescript
interface TradeRecord {
  path: string;              // æ–‡ä»¶è·¯å¾„
  name: string;              // æ–‡ä»¶å
  dateIso: string;           // æ—¥æœŸ (YYYY-MM-DD)
  ticker?: string;           // æ ‡çš„
  pnl?: number;              // ç›ˆäº (Rå€¼)
  outcome?: TradeOutcome;    // ç»“æœ
  accountType?: AccountType; // è´¦æˆ·ç±»å‹
  
  // æ™ºèƒ½è”åŠ¨å­—æ®µ
  marketCycle?: string;
  setupKey?: string;
  setupCategory?: string;
  patternsObserved?: string[];
  signalBarQuality?: string[];
  timeframe?: string;
  direction?: string;
  strategyName?: string;
  managementPlan?: string[];
  executionQuality?: string;
  cover?: string;
  
  // å…ƒæ•°æ®
  mtime?: number;
  tags?: string[];
  rawFrontmatter?: Record<string, unknown>;
}
```

### 3.2 ObsidianStrategyIndex (ç­–ç•¥ç´¢å¼•)

**èŒè´£**:
- æ‰«æç­–ç•¥ä»“åº“
- å»ºç«‹ç­–ç•¥åç§°â†’ç­–ç•¥å¡ç‰‡æ˜ å°„
- å»ºç«‹å½¢æ€â†’ç­–ç•¥æ˜ å°„

**æ ¸å¿ƒAPI**:

```typescript
class ObsidianStrategyIndex {
  // é€šè¿‡è§„èŒƒåç§°æŸ¥æ‰¾
  lookup(canonicalName: string): StrategyCard | undefined
  
  // é€šè¿‡ä»»æ„åç§°æŸ¥æ‰¾
  byName(name: string): StrategyCard | undefined
  
  // é€šè¿‡å½¢æ€æŸ¥æ‰¾
  byPattern(pattern: string): StrategyCard | undefined
  
  // è·å–æ‰€æœ‰ç­–ç•¥
  list(): StrategyCard[]
}
```

### 3.3 ObsidianTodayContext (ä»Šæ—¥ä¸Šä¸‹æ–‡)

**èŒè´£**:
- è·å–ä»Šæ—¥æ—¥è®°
- æå–ä»Šæ—¥å¸‚åœºå‘¨æœŸ
- æä¾›ä»Šæ—¥è®¡åˆ’

**æ ¸å¿ƒAPI**:

```typescript
class ObsidianTodayContext {
  // è·å–ä»Šæ—¥å¸‚åœºå‘¨æœŸ
  getTodayMarketCycle(): string | undefined
  
  // è·å–ä»Šæ—¥æ—¥è®°æ–‡ä»¶
  getTodayJournal(): TFile | undefined
}
```

---

## ğŸ§® å››ã€æ ¸å¿ƒä¸šåŠ¡å±‚ (Core Layer)

### 4.1 Analytics (æ•°æ®åˆ†æ)

**æ ¸å¿ƒåŠŸèƒ½**:

#### 1. ç­–ç•¥å½’å›  (Strategy Attribution)

**ç®—æ³•**:
```
å¯¹äºæ¯ç¬”äº¤æ˜“:
  1. ä¼˜å…ˆä½¿ç”¨ strategyName å­—æ®µ
  2. å¦‚æœä¸ºç©ºï¼Œä½¿ç”¨ patternsObserved åŒ¹é…ç­–ç•¥
  3. å¦‚æœä»ä¸ºç©ºï¼Œä½¿ç”¨ setupKey/setupCategory å…œåº•
  4. é€šè¿‡StrategyIndexæŸ¥æ‰¾è§„èŒƒåç§°
  5. èšåˆç»Ÿè®¡: count, netR
```

**å®ç°**:
```typescript
function identifyStrategyForAnalytics(
  trade: TradeRecord,
  strategyIndex?: StrategyIndex
): { name?: string; path?: string }
```

**ä¼˜å…ˆçº§**:
1. `strategyName` (æ˜¾å¼æŒ‡å®š)
2. `patternsObserved` â†’ ç­–ç•¥æ˜ å°„
3. `setupKey` / `setupCategory` â†’ å…œåº•æ˜ å°„

#### 2. ä¸Šä¸‹æ–‡åˆ†æ (Context Analysis)

**ç®—æ³•**:
```
å¯¹äºæ¯ç¬”äº¤æ˜“:
  1. æå– marketCycle å­—æ®µ
  2. è§„èŒƒåŒ–å¸‚åœºå‘¨æœŸåç§° (ä¸­è‹±æ–‡æ˜ å°„)
  3. æŒ‰å¸‚åœºå‘¨æœŸèšåˆ: count, netR, winRate
  4. æŒ‰counté™åºæ’åº
```

**å¸‚åœºå‘¨æœŸæ˜ å°„**:
```typescript
const MARKET_CYCLE_MAP = {
  "Strong Trend": "å¼ºè¶‹åŠ¿",
  "Weak Trend": "å¼±è¶‹åŠ¿",
  "Trading Range": "äº¤æ˜“åŒºé—´",
  "Breakout Mode": "çªç ´æ¨¡å¼",
  // ...
}
```

#### 3. å­¦è´¹ç»Ÿè®¡ (Tuition Analysis)

**ç®—æ³•** (v5.0å¯¹é½):
```
å¯¹äºæ¯ç¬”äº¤æ˜“:
  1. è¿‡æ»¤æ¡ä»¶:
     - accountType === "Live"
     - pnl < 0 (äºæŸ)
     - executionQuality é Perfect/Valid/None/å®Œç¾/ä¸»åŠ¨
  2. æå–é”™è¯¯ç±»å‹ (æ‹¬å·å‰æ–‡æœ¬)
  3. ç´¯åŠ  abs(pnl) ä½œä¸ºå­¦è´¹
  4. æŒ‰é”™è¯¯ç±»å‹èšåˆ
```

**å®ç°**:
```typescript
function computeTuitionAnalysis(
  trades: TradeRecord[]
): TuitionAnalysis {
  tuitionR: number;
  rows: { error: string; costR: number }[];
}
```

#### 4. æƒç›Šæ›²çº¿ (Equity Curve)

**ç®—æ³•**:
```
1. æŒ‰æ—¥æœŸèšåˆäº¤æ˜“: { dateIso, netR, count }
2. æŒ‰æ—¥æœŸå‡åºæ’åº
3. ç´¯åŠ è®¡ç®—æƒç›Š: equity += netR
4. è¿”å›: { dateIso, equityR }[]
```

### 4.2 Stats (ç»Ÿè®¡è®¡ç®—)

**æ ¸å¿ƒåŠŸèƒ½**:

#### 1. æŒ‰è´¦æˆ·ç±»å‹ç»Ÿè®¡

```typescript
function computeTradeStatsByAccountType(
  trades: TradeRecord[]
): Map<AccountType, TradeStats>

interface TradeStats {
  countTotal: number;      // æ€»äº¤æ˜“æ•°
  countCompleted: number;  // å·²å®Œæˆäº¤æ˜“æ•°
  countWins: number;       // ç›ˆåˆ©æ•°
  countLosses: number;     // äºæŸæ•°
  countScratch: number;    // ä¿æœ¬æ•°
  winRatePct: number;      // èƒœç‡ (%)
  netProfit: number;       // å‡€ç›ˆäº (R)
}
```

#### 2. ä»Šæ—¥KPIè®¡ç®—

```typescript
function calculateTodayKpi(trades: TradeRecord[]): {
  todayNetR: number;
  todayCount: number;
  todayWinRate: number;
  // ...
}
```

### 4.3 Coach (æ•™ç»ƒå»ºè®®)

**æ ¸å¿ƒåŠŸèƒ½**:

#### 1. ç„¦ç‚¹åˆ†æ (Coach Focus)

**ç®—æ³•**:
```
1. åˆ†ææœ€è¿‘Nç¬”äº¤æ˜“
2. è¯†åˆ«é«˜é¢‘é”™è¯¯æ¨¡å¼
3. æå–Top Series (é«˜é¢‘ç³»åˆ—)
4. ç”Ÿæˆé’ˆå¯¹æ€§å»ºè®®
```

#### 2. è¯¾ç¨‹æ¨è

**ç®—æ³•**:
```
1. åŸºäºäº¤æ˜“è¡¨ç°è¯†åˆ«è–„å¼±ç¯èŠ‚
2. åŒ¹é…ç›¸å…³è¯¾ç¨‹å†…å®¹
3. æŒ‰ä¼˜å…ˆçº§æ’åº
```

---

## ğŸ¨ äº”ã€è§†å›¾å±‚ (View Layer)

### 5.1 æ•°æ®è®¢é˜…æœºåˆ¶

**React Hooksé›†æˆ**:

```typescript
// Dashboard.tsx
function Dashboard() {
  const { trades, loading } = useDashboardData();
  
  useEffect(() => {
    const unsubscribe = index.onChanged(() => {
      // ç´¢å¼•å˜åŒ–æ—¶é‡æ–°åŠ è½½æ•°æ®
      loadData();
    });
    return unsubscribe;
  }, []);
}
```

**æ•°æ®æµ**:
```
Vaultå˜åŒ– â†’ IndexLayer.onChanged() â†’ React.setState() â†’ UIé‡æ¸²æŸ“
```

### 5.2 æ•°æ®è¿‡æ»¤ä¸ç­›é€‰

**Analyticsç­›é€‰å™¨**:
```typescript
interface AnalyticsFilters {
  scope: "All" | "Live" | "Demo" | "Backtest";
  dateRange: { start: string; end: string };
  strategy?: string;
  marketCycle?: string;
}

function filterTrades(
  trades: TradeRecord[],
  filters: AnalyticsFilters
): TradeRecord[]
```

### 5.3 æ•°æ®å±•ç¤ºç»„ä»¶

**æ ¸å¿ƒç»„ä»¶**:
1. **TodayKpiCard**: ä»Šæ—¥KPIå±•ç¤º
2. **EquityCurveChart**: æƒç›Šæ›²çº¿å›¾è¡¨
3. **StrategyAttribution**: ç­–ç•¥å½’å› è¡¨æ ¼
4. **ContextAnalysis**: ä¸Šä¸‹æ–‡åˆ†æè¡¨æ ¼
5. **TuitionAnalysis**: å­¦è´¹ç»Ÿè®¡

---

## ğŸ”„ å…­ã€æ•°æ®åŒæ­¥æœºåˆ¶

### 6.1 å®æ—¶ç›‘å¬

**Obsidianäº‹ä»¶ç›‘å¬**:

```typescript
// æ–‡ä»¶ä¿®æ”¹
vault.on("modify", (file) => {
  queueReindex(file);
});

// æ–‡ä»¶é‡å‘½å
vault.on("rename", (file, oldPath) => {
  updateIndex(file, oldPath);
});

// æ–‡ä»¶åˆ é™¤
vault.on("delete", (file) => {
  removeFromIndex(file);
});

// å…ƒæ•°æ®å˜åŒ–
metadataCache.on("changed", (file) => {
  queueReindex(file);
});
```

### 6.2 å¢é‡æ›´æ–°

**æ›´æ–°ç­–ç•¥**:
1. **é˜Ÿåˆ—æœºåˆ¶**: å°†å˜æ›´æ–‡ä»¶åŠ å…¥é˜Ÿåˆ—
2. **é˜²æŠ–å¤„ç†**: 200mså†…çš„å¤šæ¬¡å˜æ›´åˆå¹¶
3. **å·®å¼‚æ£€æµ‹**: JSON.stringifyæ¯”è¾ƒå‰åçŠ¶æ€
4. **æŒ‰éœ€é€šçŸ¥**: ä»…åœ¨å®é™…å˜åŒ–æ—¶è§¦å‘onChanged

### 6.3 æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–ç­–ç•¥**:
1. **æ‡’åŠ è½½**: åˆå§‹åŒ–æ—¶åˆ†æ‰¹åŠ è½½
2. **ç¼“å­˜**: å†…å­˜ç¼“å­˜è§£æç»“æœ
3. **èŠ‚æµ**: é™åˆ¶UIæ›´æ–°é¢‘ç‡
4. **è™šæ‹ŸåŒ–**: å¤§åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨

---

## ğŸ“Š ä¸ƒã€æ•°æ®å¯¼å‡º

### 7.1 å¯¼å‡ºæ ¼å¼

**JSONå¿«ç…§**:
```typescript
interface ConsoleExportSnapshot {
  exportedAt: string;
  pluginVersion: string;
  trades: TradeRecord[];
  statsByAccountType: Map<AccountType, TradeStats>;
  strategyCards: StrategyCard[];
  today: {
    marketCycle?: string;
    topStrategies: StrategyCard[];
  };
}
```

### 7.2 å¯¼å‡ºå‘½ä»¤

**å‘½ä»¤**:
1. **å¯¼å‡ºç´¢å¼•å¿«ç…§**: `snapshot_YYYYMMDD_HHMMSS.json`
2. **å¯¼å‡ºæ—§ç‰ˆå…¼å®¹å¿«ç…§**: `pa-db-export.json`

**ç”¨é€”**:
- æ•°æ®å¤‡ä»½
- å¤–éƒ¨åˆ†æ
- ç‰ˆæœ¬è¿ç§»

---

## ğŸ¯ å…«ã€å…³é”®è®¾è®¡å†³ç­–

### 8.1 ä¸ºä»€ä¹ˆä½¿ç”¨å†…å­˜ç´¢å¼•ï¼Ÿ

**ä¼˜åŠ¿**:
- âœ… æŸ¥è¯¢é€Ÿåº¦å¿« (O(1)æŸ¥æ‰¾)
- âœ… æ— éœ€å¤–éƒ¨ä¾èµ–
- âœ… å®æ—¶åŒæ­¥
- âœ… æ˜“äºè°ƒè¯•

**åŠ£åŠ¿**:
- âŒ å†…å­˜å ç”¨ (çº¦10MB/1000ç¬”äº¤æ˜“)
- âŒ å¯åŠ¨æ—¶éœ€è¦é‡å»º

**æƒè¡¡**: å¯¹äºä¸ªäººäº¤æ˜“è®°å½• (é€šå¸¸<10000ç¬”)ï¼Œå†…å­˜ç´¢å¼•æ˜¯æœ€ä¼˜é€‰æ‹©

### 8.2 ä¸ºä»€ä¹ˆä½¿ç”¨Frontmatterè€Œéæ•°æ®åº“ï¼Ÿ

**ä¼˜åŠ¿**:
- âœ… æ•°æ®å¯è¯»æ€§å¼º
- âœ… æ˜“äºæ‰‹åŠ¨ç¼–è¾‘
- âœ… ç‰ˆæœ¬æ§åˆ¶å‹å¥½
- âœ… æ— éœ€æ•°æ®è¿ç§»

**åŠ£åŠ¿**:
- âŒ æŸ¥è¯¢æ€§èƒ½å—é™
- âŒ å¤æ‚æŸ¥è¯¢å›°éš¾

**æƒè¡¡**: Obsidianç”Ÿæ€çš„æœ€ä½³å®è·µ

### 8.3 ä¸ºä»€ä¹ˆä½¿ç”¨å­—æ®µåˆ«åæ˜ å°„ï¼Ÿ

**ä¼˜åŠ¿**:
- âœ… å…¼å®¹v5æ—§æ•°æ®
- âœ… æ”¯æŒä¸­è‹±æ–‡å­—æ®µ
- âœ… çµæ´»æ€§é«˜

**å®ç°**:
```typescript
const FIELD_ALIASES = {
  pnl: ["ç›ˆäº/net_profit", "net_profit", "pnl", "r"],
  date: ["æ—¥æœŸ/date", "date", "äº¤æ˜“æ—¥æœŸ"],
  // ...
}
```

---

## ğŸ” ä¹ã€è°ƒè¯•ä¸ç›‘æ§

### 9.1 ç´¢å¼•çŠ¶æ€

**çŠ¶æ€ç±»å‹**:
```typescript
type TradeIndexStatus = 
  | { phase: "idle" }
  | { phase: "building"; processed: number; total: number }
  | { phase: "ready"; processed: number; total: number; lastBuildMs: number }
  | { phase: "error"; message: string }
```

**ç›‘æ§**:
```typescript
index.onStatusChanged(() => {
  const status = index.getStatus();
  console.log("Index status:", status);
});
```

### 9.2 æ€§èƒ½æŒ‡æ ‡

**å…³é”®æŒ‡æ ‡**:
- ç´¢å¼•æ„å»ºæ—¶é—´: `lastBuildMs`
- äº¤æ˜“è®°å½•æ•°: `trades.length`
- ç­–ç•¥å¡ç‰‡æ•°: `strategies.length`
- å†…å­˜å ç”¨: `process.memoryUsage()`

### 9.3 å¸¸è§é—®é¢˜

**é—®é¢˜1**: äº¤æ˜“æœªè¢«ç´¢å¼•
- æ£€æŸ¥: Frontmatteræ˜¯å¦åŒ…å« `tags: ["PA/Trade"]`
- æ£€æŸ¥: æ–‡ä»¶æ˜¯å¦åœ¨æ’é™¤ç›®å½•ä¸­

**é—®é¢˜2**: ç­–ç•¥å½’å› ä¸å‡†ç¡®
- æ£€æŸ¥: `strategyName` å­—æ®µæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥: `patternsObserved` æ˜¯å¦åŒ¹é…ç­–ç•¥

**é—®é¢˜3**: æ—¥æœŸæ˜¾ç¤ºé”™è¯¯
- æ£€æŸ¥: Frontmatter `date` å­—æ®µæ ¼å¼
- æ£€æŸ¥: æ–‡ä»¶åæ˜¯å¦åŒ…å«æ—¥æœŸ

---

## ğŸ“š åã€ç›¸å…³æ–‡æ¡£

- [ğŸ“š é¡¹ç›®æŠ€æœ¯æ–‡æ¡£-å®Œæ•´æ¶æ„æ‰‹å†Œ](./ğŸ“š%20é¡¹ç›®æŠ€æœ¯æ–‡æ¡£-å®Œæ•´æ¶æ„æ‰‹å†Œ.md)
- [ğŸ¯ æ’ä»¶ä¼˜åŒ–é¡¹ç›®-ç›®æ ‡æ¶æ„](./ğŸ¯%20æ’ä»¶ä¼˜åŒ–é¡¹ç›®-ç›®æ ‡æ¶æ„.md)
- [ğŸ§  æ’ä»¶æ™ºèƒ½ä¼˜åŒ–æŠ€èƒ½](./ğŸ§ %20æ’ä»¶æ™ºèƒ½ä¼˜åŒ–æŠ€èƒ½.md)

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-11)
- ğŸ“Š åˆ›å»ºå®Œæ•´æ•°æ®é€»è¾‘æ¶æ„æ–‡æ¡£
- ğŸ—‚ï¸ è¯¦ç»†æè¿°ç´¢å¼•å±‚è®¾è®¡
- ğŸ§® è¯´æ˜æ ¸å¿ƒä¸šåŠ¡å±‚ç®—æ³•
- ğŸ¨ è§£é‡Šè§†å›¾å±‚æ•°æ®è®¢é˜…æœºåˆ¶

---

**ç»´æŠ¤**: Antigravity Agent  
**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°**: 2026-01-11
